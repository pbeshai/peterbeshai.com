<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.66a4be9dcb34d5127632.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:.92em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:16px 0 32px;overflow:auto;border-bottom:2px solid #f1f3f5;background:#fbfbfc;border-radius:4px}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:none}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.24.84"/><title data-react-helmet="true">Scatterplots in D3 with Voronoi Interaction - Peter Beshai</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:700|Karla:400,400i,700" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="In this post, I explain how to add hover behavior to a scatterplot using D3&#x27;s Voronoi diagram capabilities without actually drawing the Voronoi polygons."/><meta data-react-helmet="true" name="twitter:description" content="In this post, I explain how to add hover behavior to a scatterplot using D3&#x27;s Voronoi diagram capabilities without actually drawing the Voronoi polygons."/><meta data-react-helmet="true" property="og:description" content="In this post, I explain how to add hover behavior to a scatterplot using D3&#x27;s Voronoi diagram capabilities without actually drawing the Voronoi polygons."/><meta data-react-helmet="true" name="keywords" content="dataviz, data visualization, creative coding, generative art, nba, basketball"/><meta data-react-helmet="true" name="twitter:site" content="@pbesh"/><meta data-react-helmet="true" name="twitter:creator" content="@pbesh"/><meta data-react-helmet="true" property="og:title" content="Scatterplots in D3 with Voronoi Interaction"/><meta data-react-helmet="true" property="twitter:title" content="Scatterplots in D3 with Voronoi Interaction"/><meta data-react-helmet="true" property="og:url" content="https://peterbeshai.com/blog/2016-10-30-scatterplot-in-d3-with-voronoi-interaction/"/><meta data-react-helmet="true" property="og:image" content="https://peterbeshai.com/static/6eae8687ef3d9c1b1a72e0f9b2ffe40e/35c24/preview.png"/><meta data-react-helmet="true" name="twitter:image" content="https://peterbeshai.com/static/6eae8687ef3d9c1b1a72e0f9b2ffe40e/35c24/preview.png"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><link rel="icon" href="/favicon-32x32.png?v=8eada2f2c54a980a0d0d715a284fca9b" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#000000"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><style data-styled="jlbBry ebIbsV gofAlC krNbLw gQsBqH dzArUp bhvpAY WSIGj dCCgyi senpC eKUuZz futIAd clizFh iUCFnu kzYYTh cVFjsM" data-styled-version="4.4.1">
/* sc-component-id: sc-global-1926057577 */
html,body,#___gatsby{background-color:#fff;width:100%;height:100%;padding:0;margin:0;color:#000;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:Karla,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;line-height:1.7;font-size:19px;} *{box-sizing:border-box;} #___gatsby > div{height:100%;} img.full-width-image{width:100%;} a{color:#495057;}
/* sc-component-id: core__Box-eqpeba-0 */
.jlbBry{margin-left:auto;margin-right:auto;padding:16px;max-width:800px;}.ebIbsV{margin-bottom:16px;}.gofAlC{margin-top:128px;}.krNbLw{margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:64px;padding-bottom:64px;}
/* sc-component-id: core__Text-eqpeba-2 */
.gQsBqH{text-align:center;}.dzArUp{margin-bottom:32px;margin-top:16px;}
/* sc-component-id: core__Header-eqpeba-3 */
.bhvpAY{margin:0px;font-size:23px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:uppercase;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.WSIGj{margin:0px;font-size:27px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:uppercase;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.dCCgyi{margin:0px;margin-bottom:16px;margin-top:64px;font-size:23px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:none;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.senpC{margin:0px;margin-bottom:16px;margin-top:64px;font-size:27px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:none;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}
/* sc-component-id: core__StyledLink-eqpeba-4 */
.iUCFnu{color:#495057;border-bottom:2px solid #e9ecef;-webkit-text-decoration:none;text-decoration:none;background:transparent;-webkit-transition:0.2s background linear,0.2s border-color linear;transition:0.2s background linear,0.2s border-color linear;} .iUCFnu:hover{color:#343a40;background:#e3fafc;border-color:#99e9f2;}
/* sc-component-id: core__Image-eqpeba-6 */
.kzYYTh{margin:0px;margin-left:auto;margin-right:auto;display:block;max-width:100%;height:auto;}
/* sc-component-id: core__List-eqpeba-9 */
.cVFjsM{margin-bottom:32px;margin-top:0px;}
/* sc-component-id: core__InlineList-eqpeba-10 */
.eKUuZz{list-style-type:none;padding-left:0;}.futIAd{color:#868e96;list-style-type:none;list-style-type:none;padding-left:0;}
/* sc-component-id: core__InlineListItem-eqpeba-11 */
.clizFh{margin-right:16px;display:inline-block;} .clizFh:last-child{margin-right:0;} .clizFh::before{content:'â€¢';color:#dee2e6;margin-right:16px;} .clizFh:first-child::before{content:'';margin-right:0;}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-2a15ad761d2a2d8764a5.js"/><link as="script" rel="preload" href="/framework-d80f7338bc29523a5c3b.js"/><link as="script" rel="preload" href="/app-69ce7114bdda5fe6dd69.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/commons-e0ff88392e96eab2b652.js"/><link as="script" rel="preload" href="/21b0c71395f743ee87503268ff5f3f467b604f32-4af5ab784c49a6367af2.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-cf55319c832a7ec2f72f.js"/><link as="fetch" rel="preload" href="/page-data/blog/2016-10-30-scatterplot-in-d3-with-voronoi-interaction/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="core__Box-eqpeba-0 jlbBry"><div class="core__Box-eqpeba-0 core__Text-eqpeba-2 gQsBqH"><h2 font-size="3" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 bhvpAY">Peter Beshai</h2><ul class="core__Box-eqpeba-0 core__List-eqpeba-9 core__InlineList-eqpeba-10 eKUuZz"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/">Home</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/#writing">Writing</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/#projects">Projects</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/#experiments">Experiments</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/#open-source">Open Source</a></li></ul></div></div><div class="core__Box-eqpeba-0 jlbBry"><h2 font-size="4" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 WSIGj">Scatterplots in D3 with Voronoi Interaction</h2><ul color="gray.6" class="core__Box-eqpeba-0 core__List-eqpeba-9 core__InlineList-eqpeba-10 futIAd"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh">October 30, 2016</li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh">7 min read</li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="./demo/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Demo</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://github.com/pbeshai/pbeshai.github.io/tree/master/src/blog/2016-10-30-scatterplot-in-d3-with-voronoi-interaction/demo" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">GitHub</a></li></ul><div><div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">D3 v4.3.0 was <a href="https://github.com/d3/d3/releases/v4.3.0" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">just released</a>, and it came with a notable new feature: <a href="https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_find" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu"><em>diagram</em>.find</a> for <strong>d3-voronoi</strong>. With this great addition, we are now able to easily find which Voronoi region is under the mouse without rendering the Voronoi diagram polygons and relying on SVG mouse handlers. This means we can use Voronoi interactive behavior when other overlays in the vis consume mouse events, such as when using <a href="https://github.com/d3/d3-brush" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">d3-brush</a>, or even when using canvas instead of SVG-- but those are topics for another post.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">In this post, I break down how we can make use of the new <code class="language-text">find()</code> function by using it to access the nearest point to the mouse in a scatterplot.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp"><img display="block" src="/c73d58d6d6148ef69f87705ef63305f3/scatterplot-voronoi.gif" alt="Demo GIF" class="core__Box-eqpeba-0 core__Image-eqpeba-6 kzYYTh"/></div>
<ul class="core__Box-eqpeba-0 core__List-eqpeba-9 cVFjsM">
<li class="core__Box-eqpeba-0 ebIbsV"><a href="./demo/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Live demo of the end result</a></li>
<li class="core__Box-eqpeba-0 ebIbsV"><a href="https://github.com/pbeshai/pbeshai.github.io/tree/master/src/blog/2016-10-30-scatterplot-in-d3-with-voronoi-interaction/demo" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">GitHub Code</a></li>
</ul>
<h2 font-size="3" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 dCCgyi">Why Voronoi?</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">We can think of a <a href="https://en.wikipedia.org/wiki/Voronoi_diagram" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Voronoi diagram</a> as a method for expanding the hit area around points in a chart. Each point becomes a non-overlapping region such that if the mouse is inside that region, that point is the closest point to the mouse.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">The main benefit of using a Voronoi diagram for highlighting the points in a scatterplot is that the regions defined by the diagram are typically much larger than the points, making it easier for users to explore the data. It&#x27;s also a more efficient method than computing the nearest point to the mouse position every time the mouse moves since we can precompute the Voronoi diagram once and re-use it as we need it.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Without further adieu, let&#x27;s get to making a simple scatterplot with interactivity powered by Voronoi diagrams!</div>
<h2 font-size="4" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 senpC">Building a Basic Scatterplot</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Let&#x27;s start with describing how to build a simple scatterplot in D3. If you already know this, feel free to <a href="#voronoi" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">skip to the next section</a> on adding the Voronoi-powered interaction.</div>
<h2 font-size="3" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 dCCgyi">Generating Random Data</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Before we even get started, let&#x27;s generate some random data that we can use for testing out the scatterplot. We can do this easily with <a href="https://github.com/d3/d3-array/blob/master/README.md#range" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">d3.range</a>.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// generate random data for 50 points</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  x<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  y<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  id<span class="token operator">:</span> i<span class="token punctuation">,</span>
  label<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Point </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">With that, we have an array of 50 random data points we can use with our chart.</div>
<h2 font-size="3" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 dCCgyi">Terminology</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">I use slightly different terminology for the parts of a chart than is commonly seen on <a href="http://bl.ocks.org/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">D3 blocks</a>. The standard seen in blocks is to have <code class="language-text">width</code> and <code class="language-text">height</code> describe the interior dimensions of the chart. I prefer to have <code class="language-text">width</code> and <code class="language-text">height</code> correspond to the actual outer width and height of the SVG container. I find this makes it easier to reason about when trying to layout multiple charts on a page, and is especially useful when the charts are packaged as reusable components.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:678px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:70.28571428571428%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAB7ElEQVQ4y21Ti27jIBDM/3/Y6XTSPZI45FFdq+Zat1XqFxgbjO25XQyOE9XSeIEdZpdlWWVZhiRJ8Hm5YBwG0O8Gfo0+13X4dz57y99XXMZqCBuIia7RaJVCb1q4ltFg6CzKzwv+Hg84ih1OQkCVBQZrvd8xN/AHsqvBGlhj/ESRWCZr1MYu0EE1LXJVo9INSqUhW3PHmcDZrzizhja0SuJdNUhUB3EHXtsS9rXz2PFcWiSy82PGmuaqHydB1/c+w5e8wo4cewLbpKIxC4Y5r4voI6wrM62raU26YRKsaw1Qrd6qeiZPxM4LsI1jsfBtSXAbgl4Fhx6nhwdYXSMtpRfbEDFmthQ9BMQAMfiN4OPpiGdqh4/XF7zThXDUmMWf0sxiP3ONbxeFTWlugmzDsUUUvLyleHx6gswzn2F0ikUd2f7INL6T4K+8uTm+CDVM5iNjxGuaYqT2eZeaBMx8GfGYnBXX6hCOJu5KwXz2KxYc6TI658D9eM5K/C7aOeoc3W+goy1El5e2DaWZb9nycyL7QX3I/SWUC+i83fkLuvbcprIecc68dbUQ7EiQn1haVBBU/H2hcSwJxRWnssGhmHwir/2YOfswZlTWTYJj73xjaylhauXBL4fRyMrPdVUiPT9DFfnMibzIsVrjP4eTKGJ/C4OHAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img display="block" class="core__Box-eqpeba-0 core__Image-eqpeba-6 kzYYTh gatsby-resp-image-image" alt="Chart Parts Diagram" title="Chart Parts Diagram" src="/static/fbb31790fd3cb198620689e9eb82d7fe/35a7a/chart_parts_diagram.png" srcSet="/static/fbb31790fd3cb198620689e9eb82d7fe/fe88d/chart_parts_diagram.png 175w, /static/fbb31790fd3cb198620689e9eb82d7fe/0c175/chart_parts_diagram.png 350w, /static/fbb31790fd3cb198620689e9eb82d7fe/35a7a/chart_parts_diagram.png 678w" sizes="(max-width: 678px) 100vw, 678px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">As shown in the diagram above, I use the following terms to describe the different parts of the chart:</div>





























<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code class="language-text">width</code></td><td>The outer width of the chart</td></tr><tr><td><code class="language-text">height</code></td><td>The outer height of the chart</td></tr><tr><td><code class="language-text">plotAreaWidth</code></td><td>The inner width of the chart, where the circles are plotted</td></tr><tr><td><code class="language-text">plotAreaHeight</code></td><td>The inner height of the chart, where the circles are plotted</td></tr><tr><td><code class="language-text">padding</code></td><td>The space between the outer border and the inner area (the plot  area).</td></tr></tbody></table>
<h2 font-size="3" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 dCCgyi">Setting up the Chart</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">With that out of the way, let&#x27;s get started with the code for building the chart. We first define the dimensions and padding for our scatterplot.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// outer svg dimensions</span>
<span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> height <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>

<span class="token comment">// padding around the chart where axes will go</span>
<span class="token keyword">const</span> padding <span class="token operator">=</span> <span class="token punctuation">{</span>
  top<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  right<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  bottom<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
  left<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// inner chart dimensions, where the dots are plotted</span>
<span class="token keyword">const</span> plotAreaWidth <span class="token operator">=</span> width <span class="token operator">-</span> padding<span class="token punctuation">.</span>left <span class="token operator">-</span> padding<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
<span class="token keyword">const</span> plotAreaHeight <span class="token operator">=</span> height <span class="token operator">-</span> padding<span class="token punctuation">.</span>top <span class="token operator">-</span> padding<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>

<span class="token comment">// radius of points in the scatterplot</span>
<span class="token keyword">const</span> pointRadius <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">With these base values defined, we can next define the scales we&#x27;ll use for our x and y axes and for coloring the points. Since we used <code class="language-text">Math.random()</code> to generate the x and y values, we know the domains are <code class="language-text">[0, 1]</code>, otherwise we could have used <a href="https://github.com/d3/d3-array/blob/master/README.md#extent" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">d3.extent</a> to find the min and max values in the dataset and used those for the domains.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// initialize scales</span>
<span class="token keyword">const</span> xScale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> plotAreaWidth<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> yScale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>plotAreaHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> colorScale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;#06a&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;#0bb&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">We now have all the constants and scales we need to begin generating the SVG for our chart. We do the standard procedure of creating an <code class="language-text">&lt;svg&gt;</code> element with a <code class="language-text">&lt;g&gt;</code> tag translated inside it to reflect our desired padding.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// select the root container where the chart will be added</span>
<span class="token keyword">const</span> container <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#x27;#vis-container&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// initialize main SVG</span>
<span class="token keyword">const</span> svg <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;svg&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;width&#x27;</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;height&#x27;</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// the main g where all the chart content goes inside</span>
<span class="token keyword">const</span> g <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;g&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;transform&#x27;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>padding<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>padding<span class="token punctuation">.</span>top<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">The base of the chart is now setup. Next we add the axes.</div>
<h2 font-size="3" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 dCCgyi">Adding in Axes</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Adding in axes to charts is fairly simple with D3, since it comes with built-in helpers via <a href="https://github.com/d3/d3-axis" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">d3-axis</a> for generating them with reasonable defaults. Here we create the <code class="language-text">&lt;g&gt;</code> tags to use with d3-axis as well as <code class="language-text">&lt;text&gt;</code> tags to use as axis titles.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// add in axis groups</span>
<span class="token keyword">const</span> xAxisG <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;g&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">classed</span><span class="token punctuation">(</span><span class="token string">&#x27;x-axis&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;transform&#x27;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(0 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>plotAreaHeight <span class="token operator">+</span> pointRadius<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// x-axis label</span>
g<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;text&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;transform&#x27;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>plotAreaWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>plotAreaHeight <span class="token operator">+</span> <span class="token punctuation">(</span>padding<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;dy&#x27;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// adjust distance from the bottom edge</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;axis-label&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;text-anchor&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;middle&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">&#x27;X Axis&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> yAxisG <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;g&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">classed</span><span class="token punctuation">(</span><span class="token string">&#x27;y-axis&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;transform&#x27;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">-</span>pointRadius<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 0)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// y-axis label</span>
g<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;text&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;transform&#x27;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(270) translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">-</span>plotAreaHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">-</span>padding<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;dy&#x27;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment">// adjust distance from the left edge</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;axis-label&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;text-anchor&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;middle&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">&#x27;Y Axis&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set up axis generating functions</span>
<span class="token keyword">const</span> xTicks <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>plotAreaWidth <span class="token operator">/</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> yTicks <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>plotAreaHeight <span class="token operator">/</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> xAxis <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">axisBottom</span><span class="token punctuation">(</span>xScale<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ticks</span><span class="token punctuation">(</span>xTicks<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">tickSizeOuter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> yAxis <span class="token operator">=</span> d3
  <span class="token punctuation">.</span><span class="token function">axisLeft</span><span class="token punctuation">(</span>yScale<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ticks</span><span class="token punctuation">(</span>yTicks<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">tickSizeOuter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// draw the axes</span>
<span class="token function">yAxisG</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>yAxis<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">xAxisG</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>xAxis<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">A couple things of note:</div>
<ul class="core__Box-eqpeba-0 core__List-eqpeba-9 cVFjsM">
<li class="core__Box-eqpeba-0 ebIbsV">By default, d3-axis will add squared ends to the axes. Unless these ends happen to overlap one of the ticks, there will be strange spacing between them and the actual ticks of the axis, so I always call <code class="language-text">.tickSizeOuter(0)</code> to remove them.</li>
<li class="core__Box-eqpeba-0 ebIbsV">The number of ticks in the axes, <code class="language-text">xTicks</code> and <code class="language-text">yTicks</code>, are based on the dimensions of the chart. By doing this instead of using a constant value, we ensure that our ticks do not get too compressed or too sparse as the dimensions of the chart change.</li>
</ul>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Next, we draw the points as circles.</div>
<h2 font-size="3" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 dCCgyi">Drawing the Points</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">In this example, I&#x27;m only showing the enter step of <a href="https://bl.ocks.org/mbostock/3808234" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">D3&#x27;s update pattern</a>, so we just bind the data to a collection of circles and render them using our scales.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// add in circles</span>
<span class="token keyword">const</span> circles <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;g&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;circles&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> binding <span class="token operator">=</span> circles<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&#x27;.data-point&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

binding<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;circle&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">classed</span><span class="token punctuation">(</span><span class="token string">&#x27;data-point&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;r&#x27;</span><span class="token punctuation">,</span> pointRadius<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;cx&#x27;</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">xScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;cy&#x27;</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;fill&#x27;</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">colorScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">We now have a scatterplot! ðŸŽ‰</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:608px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:68%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQ4y21UAZLDIAjM/5967UyTJlGjIscSsCatM6myArsodiIiTikxRqiVW2s8jtHG2m1fjzbGhJ89Rk6SbJePbKPKTLdkv9ajnSrxBGPfd4bSIp9vFpnrjX3JmaOQOgbCdLMnJFrXdWA5HWKpF4Vgz0aqCXgoud1KzsJM5phNZbLys+FhIADmOLdr2RMuZFmWDnRHcyoWXMmOwlTCPurp6zP8p+fzqQobSj8K5/oJdpLDME+SSu2ksLMlBK4Kt23TYA8qgyIMsrNCgF9cyPWy50PPMErb3NuiH/6PPgSZqyQ6saOcRNo2MQSVXaw0bI7JfPa9kWRNReNcqSZEyVUURSljE4dK7fISzgStl6oJaCz1Q6wlH8dxUTGeXz98VYZb/vhBAGkPcq9KFaJtgpS9yYtJKYriVc8VyoHjJb2l+XUtGPaCYK/3xq/5LXZQX+CqsKKJcbM2l1K+5sfjj+d5HnzwR4KYopjj/0OQUvJfE8Z/AAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img display="block" class="core__Box-eqpeba-0 core__Image-eqpeba-6 kzYYTh gatsby-resp-image-image" alt="Scatterplot" title="Scatterplot" src="/static/745b73485afee0564c2dcae284073d8e/c4562/scatterplot.png" srcSet="/static/745b73485afee0564c2dcae284073d8e/fe88d/scatterplot.png 175w, /static/745b73485afee0564c2dcae284073d8e/0c175/scatterplot.png 350w, /static/745b73485afee0564c2dcae284073d8e/c4562/scatterplot.png 608w" sizes="(max-width: 608px) 100vw, 608px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">With that out of the way, let&#x27;s take a look at how we can use a Voronoi diagram to add interactivity to the chart.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp"><a name="voronoi" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu"></a></div>
<h2 font-size="4" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 senpC">Adding Interactivity with a Voronoi Diagram</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">The first thing we need to do is make use of <a href="https://github.com/d3/d3-voronoi" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">d3-voronoi</a> to compute the Voronoi diagram of the points.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// create a Voronoi diagram based on the data and the scales</span>
<span class="token keyword">const</span> voronoiDiagram <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">voronoi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">xScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">[</span>plotAreaWidth<span class="token punctuation">,</span> plotAreaHeight<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">That&#x27;s all it takes to compute the diagram! <em>And</em> the <code class="language-text">size()</code> call is optional since we aren&#x27;t going to use the <code class="language-text">polygons</code> feature of the diagram. Note that we call the configured function with <code class="language-text">(data)</code> at the end, which is what computes the diagram based on our generated data.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Now that we have a computed Voronoi diagram, let&#x27;s add in some some mouse listeners to make use of it. We&#x27;ll draw an invisible rectangle over the plot area of the chart that will listen for mouse events and use the Voronoi diagram to highlight the nearest point to the mouse.</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// limit how far away the mouse can be from finding a Voronoi site</span>
<span class="token keyword">const</span> voronoiRadius <span class="token operator">=</span> plotAreaWidth <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">// add a circle for indicating the highlighted point</span>
g<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;circle&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;highlight-circle&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;r&#x27;</span><span class="token punctuation">,</span> pointRadius <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// slightly larger than our points</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&#x27;fill&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;none&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&#x27;display&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;none&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// callback to highlight a point</span>
<span class="token keyword">function</span> <span class="token function">highlight</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// no point to highlight - hide the circle</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#x27;.highlight-circle&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&#x27;display&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;none&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// otherwise, show the highlight circle at the correct position</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#x27;.highlight-circle&#x27;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&#x27;display&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&#x27;stroke&#x27;</span><span class="token punctuation">,</span> <span class="token function">colorScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;cx&#x27;</span><span class="token punctuation">,</span> <span class="token function">xScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;cy&#x27;</span><span class="token punctuation">,</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// callback for when the mouse moves across the overlay</span>
<span class="token keyword">function</span> <span class="token function">mouseMoveHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// get the current mouse position</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>mx<span class="token punctuation">,</span> my<span class="token punctuation">]</span> <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">mouse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// use the new diagram.find() function to find the Voronoi site</span>
  <span class="token comment">// closest to the mouse, limited by max distance voronoiRadius</span>
  <span class="token keyword">const</span> site <span class="token operator">=</span> voronoiDiagram<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>mx<span class="token punctuation">,</span> my<span class="token punctuation">,</span> voronoiRadius<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// highlight the point if we found one</span>
  <span class="token function">highlight</span><span class="token punctuation">(</span>site <span class="token operator">&amp;&amp;</span> site<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// add the overlay on top of everything to take the mouse events</span>
g<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;rect&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;overlay&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;width&#x27;</span><span class="token punctuation">,</span> plotAreaWidth<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;height&#x27;</span><span class="token punctuation">,</span> plotAreaHeight<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&#x27;fill&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;#f00&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&#x27;opacity&#x27;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;mousemove&#x27;</span><span class="token punctuation">,</span> mouseMoveHandler<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;mouseleave&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// hide the highlight circle when the mouse leaves the chart</span>
    <span class="token function">highlight</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">The important part is how we used <code class="language-text">voronoiDiagram.find()</code> to find the nearest Voronoi site to the mouse:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> site <span class="token operator">=</span> voronoiDiagram<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>mx<span class="token punctuation">,</span> my<span class="token punctuation">,</span> voronoiRadius<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">The <code class="language-text">site</code> object returned from this function contains a key <code class="language-text">data</code> that returns one of the data points from our original <code class="language-text">data</code> array. We then use that data point to update the position of our highlight circle, indicating to the users which point is highlighted. Since we used a Voronoi diagram, it will be the point nearest the mouse.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">This method gives us access to the highlighted data point-- we can do whatever we like with it! In the <a href="./demo/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">demo</a>, I show how we can display the contents of the highlighted point in a <code class="language-text">&lt;div&gt;</code> beneath the chart.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp"><img display="block" src="/c73d58d6d6148ef69f87705ef63305f3/scatterplot-voronoi.gif" alt="Demo GIF" class="core__Box-eqpeba-0 core__Image-eqpeba-6 kzYYTh"/></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Note that I arbitrarily set the <code class="language-text">voronoiRadius</code> to 1/10th the width of the plot area:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> voronoiRadius <span class="token operator">=</span> plotAreaWidth <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">This makes it so the point is only highlighted if you&#x27;re relatively close to it, even if you are in the corresponding voronoi cell. Feel free to play with this value to get something that works for you!</div>
<h2 font-size="4" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 senpC">Conclusion</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">That&#x27;s it! We&#x27;ve got a basic scatterplot with hover behavior driven by a Voronoi diagram. My next post will show how we can add a brush to our scatterplot to select points efficiently with a quadtree, all while retaining the hover behavior shown in this post.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">If you have any questions or comments, please leave a comment below or send me a tweet <a href="https://twitter.com/pbesh" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">@pbesh</a>. In case you missed it, there&#x27;s a <a href="./demo/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">live demo</a> of this code on my site and the full source code is available on <a href="https://github.com/pbeshai/pbeshai.github.io/tree/master/src/blog/2016-10-30-scatterplot-in-d3-with-voronoi-interaction/demo" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">GitHub</a>.</div></div><div class="core__Box-eqpeba-0 gofAlC"><div shortname="peter-beshai" config="[object Object]" id="disqus_thread"></div></div></div><div class="core__Box-eqpeba-0 krNbLw"><div class="core__Box-eqpeba-0 core__Text-eqpeba-2 gQsBqH"><ul class="core__Box-eqpeba-0 core__List-eqpeba-9 core__InlineList-eqpeba-10 eKUuZz"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="mailto:peter.beshai@gmail.com" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">peter.beshai@gmail.com</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://twitter.com/pbesh" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Twitter</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://twitch.tv/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Twitch</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://github.com/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">GitHub</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://instagram.com/pbeshasketch" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Instagram</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://www.linkedin.com/in/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">LinkedIn</a></li></ul></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-55938435-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2016-10-30-scatterplot-in-d3-with-voronoi-interaction/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b540199392df4ae4b2b3.js"],"app":["/app-69ce7114bdda5fe6dd69.js"],"component---src-pages-404-js":["/component---src-pages-404-js-068e2989b2757c283e4d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-9f01cb6a6ce89fbd850d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-cf55319c832a7ec2f72f.js"],"component---src-templates-demo-js":["/component---src-templates-demo-js-1d19251ac55752766669.js"]};/*]]>*/</script><script src="/polyfill-b540199392df4ae4b2b3.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-cf55319c832a7ec2f72f.js" async=""></script><script src="/21b0c71395f743ee87503268ff5f3f467b604f32-4af5ab784c49a6367af2.js" async=""></script><script src="/commons-e0ff88392e96eab2b652.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-69ce7114bdda5fe6dd69.js" async=""></script><script src="/framework-d80f7338bc29523a5c3b.js" async=""></script><script src="/webpack-runtime-2a15ad761d2a2d8764a5.js" async=""></script></body></html>