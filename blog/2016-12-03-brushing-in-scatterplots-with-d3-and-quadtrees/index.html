<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.a6cf05b5abeb1d21fb12.css">/* ! tailwindcss v2.1.2 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-moz-tab-size:4;-o-tab-size:4;tab-size:4;line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{height:0;color:inherit}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:IBM Plex Sans,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input:-ms-input-placeholder,textarea:-ms-input-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,ui-monospace,SFMono-Regular,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{font-size:1rem;line-height:1.5rem;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity));font-family:IBM Plex Sans,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;--tw-text-opacity:1;color:rgba(17,24,39,var(--tw-text-opacity));font-kerning:normal;font-feature-settings:"kern","liga","clig","calt";font-variant-ligatures:none;font-variant:none}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.prose{color:#374151;max-width:65ch}.prose [class~=lead]{color:#4b5563;font-size:1.25em;line-height:1.6;margin-top:1.2em;margin-bottom:1.2em}.prose a{color:#111827;text-decoration:underline;font-weight:500}.prose strong{color:#111827;font-weight:600}.prose ol[type=A]{--list-counter-style:upper-alpha}.prose ol[type=a]{--list-counter-style:lower-alpha}.prose ol[type=I]{--list-counter-style:upper-roman}.prose ol[type=i]{--list-counter-style:lower-roman}.prose ol[type="1"]{--list-counter-style:decimal}.prose ol>li{position:relative;padding-left:1.75em}.prose ol>li:before{content:counter(list-item,var(--list-counter-style,decimal)) ".";position:absolute;font-weight:400;color:#6b7280;left:0}.prose ul>li{position:relative;padding-left:1.75em}.prose ul>li:before{content:"";position:absolute;background-color:#d1d5db;border-radius:50%;width:.375em;height:.375em;top:.6875em;left:.25em}.prose hr{border-color:#e5e7eb;border-top-width:1px;margin-top:3em;margin-bottom:3em}.prose blockquote{font-weight:500;font-style:italic;color:#111827;border-left-width:.25rem;border-left-color:#e5e7eb;quotes:"\201C""\201D""\2018""\2019";margin-top:1.6em;margin-bottom:1.6em;padding-left:1em}.prose blockquote p:first-of-type:before{content:open-quote}.prose blockquote p:last-of-type:after{content:close-quote}.prose h1{color:#111827;font-weight:800;font-size:2.25em;margin-top:0;margin-bottom:.8888889em;line-height:1.1111111}.prose h2{color:#111827;font-weight:700;font-size:1.5em;margin-top:2em;margin-bottom:1em;line-height:1.3333333}.prose h3{font-size:1.25em;margin-top:1.6em;margin-bottom:.6em;line-height:1.6}.prose h3,.prose h4{color:#111827;font-weight:600}.prose h4{margin-top:1.5em;margin-bottom:.5em;line-height:1.5}.prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose code{color:#111827;font-weight:600;font-size:.875em}.prose code:after,.prose code:before{content:"`"}.prose a code{color:#111827}.prose pre{color:#e5e7eb;background-color:#1f2937;overflow-x:auto;font-size:.875em;line-height:1.7142857;margin-top:1.7142857em;margin-bottom:1.7142857em;border-radius:.375rem;padding:.8571429em 1.1428571em}.prose pre code{background-color:transparent;border-width:0;border-radius:0;padding:0;font-weight:400;color:inherit;font-size:inherit;font-family:inherit;line-height:inherit}.prose pre code:after,.prose pre code:before{content:none}.prose table{width:100%;table-layout:auto;text-align:left;margin-top:2em;margin-bottom:2em;font-size:.875em;line-height:1.7142857}.prose thead{color:#111827;font-weight:600;border-bottom-width:1px;border-bottom-color:#d1d5db}.prose thead th{vertical-align:bottom;padding-right:.5714286em;padding-bottom:.5714286em;padding-left:.5714286em}.prose tbody tr{border-bottom-width:1px;border-bottom-color:#e5e7eb}.prose tbody tr:last-child{border-bottom-width:0}.prose tbody td{vertical-align:top;padding:.5714286em}.prose{font-size:1rem;line-height:1.75}.prose p{margin-top:1.25em;margin-bottom:1.25em}.prose figure,.prose img,.prose video{margin-top:2em;margin-bottom:2em}.prose figure>*{margin-top:0;margin-bottom:0}.prose h2 code{font-size:.875em}.prose h3 code{font-size:.9em}.prose ol,.prose ul{margin-top:1.25em;margin-bottom:1.25em}.prose li{margin-top:.5em;margin-bottom:.5em}.prose>ul>li p{margin-top:.75em;margin-bottom:.75em}.prose>ul>li>:first-child{margin-top:1.25em}.prose>ul>li>:last-child{margin-bottom:1.25em}.prose>ol>li>:first-child{margin-top:1.25em}.prose>ol>li>:last-child{margin-bottom:1.25em}.prose ol ol,.prose ol ul,.prose ul ol,.prose ul ul{margin-top:.75em;margin-bottom:.75em}.prose h2+*,.prose h3+*,.prose h4+*,.prose hr+*{margin-top:0}.prose thead th:first-child{padding-left:0}.prose thead th:last-child{padding-right:0}.prose tbody td:first-child{padding-left:0}.prose tbody td:last-child{padding-right:0}.prose>:first-child{margin-top:0}.prose>:last-child{margin-bottom:0}.bg-black{--tw-bg-opacity:1;background-color:rgba(0,0,0,var(--tw-bg-opacity))}.rounded-lg{border-radius:.5rem}.border{border-width:1px}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.table{display:table}.grid{display:grid}.hidden{display:none}.font-semibold{font-weight:600}.font-bold{font-weight:700}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.leading-loose{line-height:2}.m-1{margin:.25rem}.my-1{margin-top:.25rem;margin-bottom:.25rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-4{margin-bottom:1rem}.mt-8{margin-top:2rem}.mb-12{margin-bottom:3rem}.max-w-md{max-width:28rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.pt-8{padding-top:2rem}.pb-12{padding-bottom:3rem}.fixed{position:fixed}.absolute{position:absolute}.resize{resize:both}*{--tw-shadow:0 0 transparent;--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 transparent;--tw-ring-shadow:0 0 transparent}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgba(55,65,81,var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.text-pink-400{--tw-text-opacity:1;color:rgba(244,114,182,var(--tw-text-opacity))}.text-cyan-500{--tw-text-opacity:1;color:rgba(6,182,212,var(--tw-text-opacity))}.uppercase{text-transform:uppercase}.visible{visibility:visible}.w-1{width:.25rem}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.transform{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}.filter{--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.invert{--tw-invert:invert(100%)}.funky-underline{display:inline-block;position:relative}.funky-underline:before{--underline-color:#22d3ee;position:absolute;bottom:-1px;left:-2px;right:-4px;content:"";height:4px;border-radius:99999px;background:var(--underline-color);transform:rotate(-2deg)}:root{--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-400:#9ca3af;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-800:#1f2937;--gray-900:#111827;--cyan-400:#22d3ee;--cyan-500:#06b6d4}.prose a{text-decoration:none}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:.92em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:16px 0 32px;overflow:auto;border:1px solid var(--gray-200);background:var(--gray-50);border-radius:4px}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:none}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.24.84"/><title data-react-helmet="true">Brushing in Scatterplots with D3 and Quadtrees - Peter Beshai</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,400i,500,600,700" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="In this post, I explain how to add brushing to a D3 scatterplot by using d3-brush and quadtrees for efficient lookup of highlighted points."/><meta data-react-helmet="true" name="twitter:description" content="In this post, I explain how to add brushing to a D3 scatterplot by using d3-brush and quadtrees for efficient lookup of highlighted points."/><meta data-react-helmet="true" property="og:description" content="In this post, I explain how to add brushing to a D3 scatterplot by using d3-brush and quadtrees for efficient lookup of highlighted points."/><meta data-react-helmet="true" name="keywords" content="dataviz, data visualization, creative coding, generative art, nba, basketball"/><meta data-react-helmet="true" name="twitter:site" content="@pbesh"/><meta data-react-helmet="true" name="twitter:creator" content="@pbesh"/><meta data-react-helmet="true" property="og:title" content="Brushing in Scatterplots with D3 and Quadtrees"/><meta data-react-helmet="true" property="twitter:title" content="Brushing in Scatterplots with D3 and Quadtrees"/><meta data-react-helmet="true" property="og:url" content="https://peterbeshai.com/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/"/><meta data-react-helmet="true" property="og:image" content="https://peterbeshai.com/static/e44b12233241bc86eb1ef65635f82cb5/35c24/preview.png"/><meta data-react-helmet="true" name="twitter:image" content="https://peterbeshai.com/static/e44b12233241bc86eb1ef65635f82cb5/35c24/preview.png"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><link rel="icon" href="/favicon-32x32.png?v=8eada2f2c54a980a0d0d715a284fca9b" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#000000"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><style data-styled="dgrgPo bRzELH lcczCA gofAlC krNbLw liYjay cgJpCM hRIHo hJIQXL eiraze iZTvUI gQsBqH" data-styled-version="4.4.1">
/* sc-component-id: core__Box-eqpeba-0 */
.lcczCA{margin-left:auto;margin-right:auto;padding:16px;max-width:65ch;}.gofAlC{margin-top:128px;}.krNbLw{margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:64px;padding-bottom:64px;}
/* sc-component-id: core__Flex-eqpeba-1 */
.dgrgPo{margin-top:16px;margin-bottom:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}
/* sc-component-id: core__Text-eqpeba-2 */
.gQsBqH{text-align:center;}
/* sc-component-id: core__Header-eqpeba-3 */
.liYjay{margin:0px;margin-bottom:8px;font-size:27px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;color:#1f2937;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;line-height:1.15;-webkit-letter-spacing:-0.01em;-moz-letter-spacing:-0.01em;-ms-letter-spacing:-0.01em;letter-spacing:-0.01em;}
/* sc-component-id: core__StyledLink-eqpeba-5 */
.eiraze{color:#374151;border-bottom:2px solid #e5e7eb;-webkit-text-decoration:none;text-decoration:none;background:transparent;-webkit-transition:0.2s background linear,0.2s border-color linear;transition:0.2s background linear,0.2s border-color linear;} .eiraze:hover{color:#1f2937;background:#e3fafc;border-color:#99e9f2;}
/* sc-component-id: core__Image-eqpeba-7 */
.iZTvUI{margin:0px;margin-left:auto;margin-right:auto;display:block;max-width:100%;height:auto;}
/* sc-component-id: core__InlineList-eqpeba-11 */
.cgJpCM{margin-bottom:8px;color:#4b5563;list-style-type:none;list-style-type:none;padding-left:0;}.hRIHo{list-style-type:none;padding-left:0;}
/* sc-component-id: core__InlineListItem-eqpeba-12 */
.hJIQXL{margin-right:16px;display:inline-block;} .hJIQXL:last-child{margin-right:0;} .hJIQXL::before{content:'•';color:#d1d5db;margin-right:16px;} .hJIQXL:first-child::before{content:'';margin-right:0;}
/* sc-component-id: layout___StyledText-sc-1yov7wq-0 */
.bRzELH{padding-left:8px;padding-right:8px;font-size:16px;color:#ffffff;background-color:#000000;font-weight:700;border-radius:5px;box-shadow:3px 4px #3bc9db;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:box-shadow 200ms;transition:box-shadow 200ms;} .bRzELH:hover{box-shadow:5px 6px #3bc9db;} .bRzELH:active{box-shadow:2px 3px #3bc9db;}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-06a9210293dd0d2a2358.js"/><link as="script" rel="preload" href="/framework-d80f7338bc29523a5c3b.js"/><link as="script" rel="preload" href="/app-fcd7ff88a19f1bf11c6c.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/commons-16a344fd9551feb818bd.js"/><link as="script" rel="preload" href="/21b0c71395f743ee87503268ff5f3f467b604f32-88a5d176af816359574b.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-0d55bb857b27ef483d4e.js"/><link as="fetch" rel="preload" href="/page-data/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="core__Box-eqpeba-0 core__Flex-eqpeba-1 dgrgPo"><a bg="black" color="white" px="2" font-size="1" font-weight="700" class="core__Box-eqpeba-0 core__Text-eqpeba-2 layout___StyledText-sc-1yov7wq-0 bRzELH" href="/">Peter Beshai</a></div><div class="core__Box-eqpeba-0 lcczCA"><h2 font-size="4" font-weight="bold" font-family="header" color="gray.8" letter-spacing="-0.01em" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 liYjay">Brushing in Scatterplots with D3 and Quadtrees</h2><ul color="gray.6" class="core__Box-eqpeba-0 core__List-eqpeba-10 core__InlineList-eqpeba-11 cgJpCM"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL">December 3, 2016</li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL">7 min read</li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="./demo/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Demo</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://github.com/pbeshai/pbeshai.github.io/tree/master/src/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/demo" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">GitHub</a></li></ul><div class="prose"><div><p>One of the most common interaction idioms for data visualization is to select by clicking and dragging, also known as brushing. In this post, I&#x27;ll focus on how to implement brushing in a scatterplot with D3 through the use of two packages: <a href="https://github.com/d3/d3-brush" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">d3-brush</a> and <a href="https://github.com/d3/d3-quadtree" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">d3-quadtree</a>. The main brushing interaction comes from d3-brush, while efficient look-up of what is covered by the brush is done via d3-quadtree. Handy helper functions for making this easier are available in my <a href="https://github.com/pbeshai/vis-utils" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">vis-utils</a> repo.</p>
<p><img display="block" src="/435d956081db9f81aa88ebafed702460/scatterplot-brushing.gif" alt="Demo GIF" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI"/></p>
<ul>
<li><a href="./demo/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Live demo of the end result</a></li>
<li><a href="https://github.com/pbeshai/pbeshai.github.io/tree/master/src/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/demo" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">GitHub Code</a> </li>
</ul>
<h3>Building a Basic Scatterplot</h3>
<p>To get details on how to build a basic scatterplot and some of the terminology I typically use when discussing them, see <a href="%7B%25%20post_url%202016-10-30-scatterplot-in-d3-with-voronoi-interaction%20%25%7D" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">my other post on adding Voronoi-based interaction to scatterplots</a>. In this post, we&#x27;ll build up from that same base scatterplot.</p>
<h2>Adding a Brush</h2>
<p>There are really two main steps to getting brushing working in a scatterplot:</p>
<ol>
<li>Add the brush interaction with visual feedback</li>
<li>Interpret what is selected by the brush and update the vis accordingly</li>
</ol>
<p>Let&#x27;s start by using d3-brush to add in the brush interaction!</p>
<h3>Showing the Brush</h3>
<p>It turns out this is really easy. There are two things you need to do: create the brush generator then call it on a <code class="language-text">&lt;g&gt;</code> tag.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// create the d3-brush generator</span>
<span class="token keyword">const</span> brush <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">brush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">extent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>plotAreaWidth<span class="token punctuation">,</span> plotAreaHeight<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// attach the brush to the chart</span>
<span class="token keyword">const</span> gBrush <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#x27;g&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#x27;class&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;brush&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>brush<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>In the above code, we create <code class="language-text">brush</code>, a brush generator that covers the rectangular area where dots are plotted in the chart. This prevents the user from being able to select the axis region (see <a href="%7B%25%20post_url%202016-10-30-scatterplot-in-d3-with-voronoi-interaction%20%25%7D" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">my other post</a> for why I call the dimensions plotAreaWidth, plotAreaHeight). Now, similar to how we generate axes in D3, we just call <code class="language-text">.call(brush)</code> on a <code class="language-text">&lt;g&gt;</code> tag and D3 works its magic to enable a brush.</p>
<p>Note: <code class="language-text">d3.brush()</code> creates a 2D brush. If you wanted a 1D brush, try <code class="language-text">d3.brushX()</code> or <code class="language-text">d3.brushY()</code>. See <a href="https://github.com/d3/d3-brush" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">the docs</a> for more details.</p>
<p>At this point, our chart looks something like:</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">transform</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>translate(paddingLeft paddingTop)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ... the chart ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>brush<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>... children generated by `brush` ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<p>I&#x27;ve put the brush group below the rest of the chart so that it overlaps everything else. This ensures that the mouse handler overlay is not obstructed by anything and thus receives all mouse events.</p>
<p><img display="block" src="/72a7a72aacdb745db95340f78cf9e1db/brush1.gif" alt="D3-Brush attached" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI"/></p>
<p>Not bad. D3 generously provides us with a brush that is really user friendly: you can click and drag to initialize it, resize by dragging the edges, and even move it around by dragging the rectangle. If you want to change the styling of the box that is rendered, modify the element <code class="language-text">.selection</code> inside the brush <code class="language-text">&lt;g&gt;</code> tag.</p>
<h3>Making the Brush Actually Do Something</h3>
<p>We&#x27;ve got something that looks like a brush, and while that&#x27;s cool and all, it would be better if it actually did something. We&#x27;ll push forward and see how we can use quadtrees to efficiently find the points covered by the brush and then highlight them on screen.</p>
<p>The first step is to hook into events that d3-brush provides. We will provide a handler <code class="language-text">updateBrush</code> for when the brush changes and when it finishes. Just like all other D3 code, we use <code class="language-text">.on()</code> to attach to the desired events:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> brush <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">brush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">extent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>plotAreaWidth<span class="token punctuation">,</span> plotAreaHeight<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;brush end&#x27;</span><span class="token punctuation">,</span> updateBrush<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now, what does <code class="language-text">updateBrush</code> do? It&#x27;s job is to find which points are highlighted by the brush and then update them accordingly. Through the object <code class="language-text">d3.event</code>, we can read a property called <code class="language-text">selection</code> which gives us the rectangular dimensions of the brush in the form <code class="language-text">[[left, top], [right, bottom]]</code>. We can then use those dimensions to figure out which items are selected by the brush.</p>
<p>The naive method would be to simply iterate over our data and find which points are covered by the brush:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">naiveUpdateBrush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> selection <span class="token punctuation">}</span> <span class="token operator">=</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">;</span>
  <span class="token keyword">const</span> brushedNodes <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span>
    <span class="token comment">// helper function that returns true if the point is</span>
    <span class="token comment">// within the selection rect</span>
    <span class="token function">rectContains</span><span class="token punctuation">(</span>selection<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">xScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// helper to visualize the highlighted data points</span>
  <span class="token comment">// see the full source code for details</span>
  <span class="token function">highlightBrushed</span><span class="token punctuation">(</span>brushedNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This works fine for a small number of points, but it requires you to scan through every single point in the chart every time the brush changes. This callback is called very frequently while the brush is moved around, so we want it to be as fast as possible to prevent a laggy user experience. However, if you don&#x27;t notice any problem with this simple method, use it! There&#x27;s no point prematurely optimizing if you are not currently experiencing any issues.</p>
<h4>Quadtree Optimization</h4>
<p>Similar to how we can use a binary tree to skip nodes we search through when performing a binary search, we can use a quadtree to skip 2D regions of our scatterplot. This allows us to compare fewer points in the chart, reducing the run time of our <code class="language-text">updateBrush</code> function.</p>
<p>Quadtrees essentially breakdown our data into nested rectangular regions where the leaves only contain a single element. Our chart with a quadtree overlaid looks like this:</p>
<p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:700px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:66.85714285714286%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnUlEQVQ4y2VTi47DMAjr/39opV23vts8W84mpJfpIqGUBYwxrLvvW9ZtkzMmua5Lcs56V6v+DUv43mN8fj9T+hfXCc5+HHI4J1KBUKQF5TkBtIcgDiA8EfcZorhYfALSOjJ8j6NsAJyd1x9vYyR4C0yEESAnsLB3hwIeYBNykjFUQKKv+y7j6eTwhUFAYMCjGFNX24ZfrTJnIRa92paXdRWHdmqVDVUPtCNWWfVr9CqapdIBih9gS2Bq3C3LIvM8a6LqCZbRklUCY0I/2WAibrZLo448XmUxwA1TroBkwkBqxGCdJnzekaZMLmW2uqAFigRNyy3DP60KMw2GZUvkVCMBU2m5rEuG/rEwZJLDhCMYMYDa6SBC+hpEBWQS49gJtZ4Orx3RzyikazNibXQtbAgJST/LXgZh06tDuZtFZo4yMwnI9GEYwDBk7t4l2+llgcFRVrV1+yw+QKmxbxZbNWTgMAyqI41D+oDxZ5oef8VazfDHecGfYCo+3vrXIK/3KBPeGEdiXZ1s21a5s+mSVd++7yUEr/v3FWfv1f8Fucj9aJQNFNcAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img display="block" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI gatsby-resp-image-image" alt="Quadtree overlaid on our data" title="Quadtree overlaid on our data" src="/static/b26a0942958fe6dfd3e1785c38d81a1a/f6cdf/quadtree.png" srcSet="/static/b26a0942958fe6dfd3e1785c38d81a1a/fe88d/quadtree.png 175w, /static/b26a0942958fe6dfd3e1785c38d81a1a/0c175/quadtree.png 350w, /static/b26a0942958fe6dfd3e1785c38d81a1a/f6cdf/quadtree.png 700w, /static/b26a0942958fe6dfd3e1785c38d81a1a/4cbff/quadtree.png 1050w, /static/b26a0942958fe6dfd3e1785c38d81a1a/a4092/quadtree.png 1228w" sizes="(max-width: 700px) 100vw, 700px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p>
<p>So how do we use one? The first step is to create a quadtree using <code class="language-text">d3.quadtree()</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// generate a quadtree for faster lookups for brushing</span>
<span class="token keyword">const</span> quadtree <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">quadtree</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">xScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>It&#x27;s a similar interface to other D3 components: we specify how to interpret x and y in our data and then pass it our data for it to generate itself from. And just like that we have a quadtree for our dataset.</p>
<p>For performance, we only generate the quadtree once and then reuse it each time we brush. The optimization part comes in by traversing the quadtree via its <code class="language-text">visit()</code> function instead of scanning through all data points as we did above.</p>
<p>Here&#x27;s our updated <code class="language-text">updateBrush()</code> function that uses the quadtree:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// callback when the brush updates / ends</span>
<span class="token keyword">function</span> <span class="token function">updateBrush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> selection <span class="token punctuation">}</span> <span class="token operator">=</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">;</span>

  <span class="token comment">// if we have no selection, just reset the brush highlight to no nodes</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">highlightBrushed</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// begin an array to collect the brushed nodes</span>
  <span class="token keyword">const</span> brushedNodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// traverse the quad tree, skipping branches where we do not overlap</span>
  <span class="token comment">// with the brushed selection box</span>
  quadtree<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// check that quadtree node intersects</span>
    <span class="token keyword">const</span> overlaps <span class="token operator">=</span> <span class="token function">rectIntersects</span><span class="token punctuation">(</span>selection<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// skip if it doesn&#x27;t overlap the brush</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>overlaps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// if this is a leaf node (node.length is falsy), verify it is within the brush</span>
    <span class="token comment">// we have to do this since an overlapping quadtree box does not guarantee</span>
    <span class="token comment">// that all the points within that box are covered by the brush.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> d <span class="token operator">=</span> node<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token function">xScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token function">yScale</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rectContains</span><span class="token punctuation">(</span>selection<span class="token punctuation">,</span> <span class="token punctuation">[</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        brushedNodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// return false so that we traverse into branch (only useful for non-leaf nodes)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// update the highlighted brushed nodes</span>
  <span class="token function">highlightBrushed</span><span class="token punctuation">(</span>brushedNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The main points to take away from this approach is that we do two things while traversing the tree:</p>
<ol>
<li>We check to see if the current node of the tree overlaps the brush by using the <code class="language-text">rectIntersects</code> command. This allows us to skip entire branches of the tree if they do not overlap the brush at all.</li>
<li>Once we reach a leaf node (determined by not having <code class="language-text">node.length</code>), we verify that the point inside that leaf is actually contained within the brush. This is necessary since the quadtree region is larger than the point and so it can commonly be the case that the brush covers a leaf node&#x27;s quadtree region, but does not cover the point itself.</li>
</ol>
<p>To facilitate doing these checks, I use two functions: <code class="language-text">rectIntersects</code> and <code class="language-text">rectContains</code>. These are available in my <a href="https://github.com/pbeshai/vis-utils" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">vis-utils</a> repo, but are also reproduced in the <a href="https://github.com/pbeshai/pbeshai.github.io/tree/master/src/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/demo" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">source code</a> of this example for convenience. If you just want a single function call to tell you what&#x27;s contained under a brush, the vis-utils functions <code class="language-text">filterInRect</code> and <code class="language-text">filterInRectFromQuadtree</code> do the same thing as is described in this post.</p>
<p>Here&#x27;s a slowed down animation of how this all works in practice (you can see this yourself on the <a href="./demo/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">demo</a> by revealing the quadtree):</p>
<p><img display="block" src="/28aa3b6e39553f029171b5ee33d87bdd/brush-quadtree.gif" alt="Quadtree traverse demonstration" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI"/></p>
<p>Each quadtree node that is visited is rendered with a translucent gray background. We can see that more than half of the chart is pruned from the search!</p>
<p><em>Shout out to <a href="https://twitter.com/ireneros" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Irene Ros</a>, Director of <a href="https://bocoup.com/datavis" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Data Vis at Bocoup</a>, for the encouragement to visually demonstrate the quadtree traversal!</em></p>
<h2>Bonus: Add Voronoi Hover Interaction</h2>
<p>If you want to support both having hover behavior and a brush, you can do so using the Voronoi-based interaction I discussed in <a href="%7B%25%20post_url%202016-10-30-scatterplot-in-d3-with-voronoi-interaction%20%25%7D" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">my previous post</a> by attaching the Voronoi mouse listeners to the brush&#x27;s <code class="language-text">.overlay</code> element. See the <a href="https://github.com/pbeshai/pbeshai.github.io/tree/master/src/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/demo" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">source code</a> for details.</p>
<h2>Conclusion</h2>
<p>That wraps it up! We can now add brushing and hover behavior to our scatterplots with D3. Keep in mind that jumping directly to using quadtrees for your scatterplots may be unnecessary if you are only working with a small number of data points-- sometimes simpler can be better. But in the event that you do want that optimization, I hope that this post has helped you understand how to do it!</p>
<p>As always, if you have any questions or comments feel free to reach out to me on twitter <a href="https://twitter.com/pbesh" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">@pbesh</a>.</p></div></div><div class="core__Box-eqpeba-0 gofAlC"><div shortname="peter-beshai" config="[object Object]" id="disqus_thread"></div></div></div><div class="core__Box-eqpeba-0 krNbLw"><div class="core__Box-eqpeba-0 core__Text-eqpeba-2 gQsBqH"><ul class="core__Box-eqpeba-0 core__List-eqpeba-10 core__InlineList-eqpeba-11 hRIHo"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="mailto:peter.beshai@gmail.com" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">peter.beshai@gmail.com</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://twitter.com/pbesh" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Twitter</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://twitch.tv/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Twitch</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://github.com/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">GitHub</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://instagram.com/pbeshasketch" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Instagram</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://www.linkedin.com/in/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">LinkedIn</a></li></ul></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-55938435-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2016-12-03-brushing-in-scatterplots-with-d3-and-quadtrees/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b540199392df4ae4b2b3.js"],"app":["/app-fcd7ff88a19f1bf11c6c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c2832438e0b6a94d149f.js"],"component---src-pages-index-js":["/component---src-pages-index-js-9fd4d7b2f08ac5830f3c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-0d55bb857b27ef483d4e.js"],"component---src-templates-demo-js":["/component---src-templates-demo-js-86292a96b849eb84e1cf.js"]};/*]]>*/</script><script src="/polyfill-b540199392df4ae4b2b3.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-0d55bb857b27ef483d4e.js" async=""></script><script src="/21b0c71395f743ee87503268ff5f3f467b604f32-88a5d176af816359574b.js" async=""></script><script src="/commons-16a344fd9551feb818bd.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-fcd7ff88a19f1bf11c6c.js" async=""></script><script src="/framework-d80f7338bc29523a5c3b.js" async=""></script><script src="/webpack-runtime-06a9210293dd0d2a2358.js" async=""></script></body></html>