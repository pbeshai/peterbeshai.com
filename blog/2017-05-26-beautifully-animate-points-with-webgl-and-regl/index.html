<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.a6cf05b5abeb1d21fb12.css">/* ! tailwindcss v2.1.2 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-moz-tab-size:4;-o-tab-size:4;tab-size:4;line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{height:0;color:inherit}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:IBM Plex Sans,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input:-ms-input-placeholder,textarea:-ms-input-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,ui-monospace,SFMono-Regular,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{font-size:1rem;line-height:1.5rem;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity));font-family:IBM Plex Sans,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;--tw-text-opacity:1;color:rgba(17,24,39,var(--tw-text-opacity));font-kerning:normal;font-feature-settings:"kern","liga","clig","calt";font-variant-ligatures:none;font-variant:none}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.prose{color:#374151;max-width:65ch}.prose [class~=lead]{color:#4b5563;font-size:1.25em;line-height:1.6;margin-top:1.2em;margin-bottom:1.2em}.prose a{color:#111827;text-decoration:underline;font-weight:500}.prose strong{color:#111827;font-weight:600}.prose ol[type=A]{--list-counter-style:upper-alpha}.prose ol[type=a]{--list-counter-style:lower-alpha}.prose ol[type=I]{--list-counter-style:upper-roman}.prose ol[type=i]{--list-counter-style:lower-roman}.prose ol[type="1"]{--list-counter-style:decimal}.prose ol>li{position:relative;padding-left:1.75em}.prose ol>li:before{content:counter(list-item,var(--list-counter-style,decimal)) ".";position:absolute;font-weight:400;color:#6b7280;left:0}.prose ul>li{position:relative;padding-left:1.75em}.prose ul>li:before{content:"";position:absolute;background-color:#d1d5db;border-radius:50%;width:.375em;height:.375em;top:.6875em;left:.25em}.prose hr{border-color:#e5e7eb;border-top-width:1px;margin-top:3em;margin-bottom:3em}.prose blockquote{font-weight:500;font-style:italic;color:#111827;border-left-width:.25rem;border-left-color:#e5e7eb;quotes:"\201C""\201D""\2018""\2019";margin-top:1.6em;margin-bottom:1.6em;padding-left:1em}.prose blockquote p:first-of-type:before{content:open-quote}.prose blockquote p:last-of-type:after{content:close-quote}.prose h1{color:#111827;font-weight:800;font-size:2.25em;margin-top:0;margin-bottom:.8888889em;line-height:1.1111111}.prose h2{color:#111827;font-weight:700;font-size:1.5em;margin-top:2em;margin-bottom:1em;line-height:1.3333333}.prose h3{font-size:1.25em;margin-top:1.6em;margin-bottom:.6em;line-height:1.6}.prose h3,.prose h4{color:#111827;font-weight:600}.prose h4{margin-top:1.5em;margin-bottom:.5em;line-height:1.5}.prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose code{color:#111827;font-weight:600;font-size:.875em}.prose code:after,.prose code:before{content:"`"}.prose a code{color:#111827}.prose pre{color:#e5e7eb;background-color:#1f2937;overflow-x:auto;font-size:.875em;line-height:1.7142857;margin-top:1.7142857em;margin-bottom:1.7142857em;border-radius:.375rem;padding:.8571429em 1.1428571em}.prose pre code{background-color:transparent;border-width:0;border-radius:0;padding:0;font-weight:400;color:inherit;font-size:inherit;font-family:inherit;line-height:inherit}.prose pre code:after,.prose pre code:before{content:none}.prose table{width:100%;table-layout:auto;text-align:left;margin-top:2em;margin-bottom:2em;font-size:.875em;line-height:1.7142857}.prose thead{color:#111827;font-weight:600;border-bottom-width:1px;border-bottom-color:#d1d5db}.prose thead th{vertical-align:bottom;padding-right:.5714286em;padding-bottom:.5714286em;padding-left:.5714286em}.prose tbody tr{border-bottom-width:1px;border-bottom-color:#e5e7eb}.prose tbody tr:last-child{border-bottom-width:0}.prose tbody td{vertical-align:top;padding:.5714286em}.prose{font-size:1rem;line-height:1.75}.prose p{margin-top:1.25em;margin-bottom:1.25em}.prose figure,.prose img,.prose video{margin-top:2em;margin-bottom:2em}.prose figure>*{margin-top:0;margin-bottom:0}.prose h2 code{font-size:.875em}.prose h3 code{font-size:.9em}.prose ol,.prose ul{margin-top:1.25em;margin-bottom:1.25em}.prose li{margin-top:.5em;margin-bottom:.5em}.prose>ul>li p{margin-top:.75em;margin-bottom:.75em}.prose>ul>li>:first-child{margin-top:1.25em}.prose>ul>li>:last-child{margin-bottom:1.25em}.prose>ol>li>:first-child{margin-top:1.25em}.prose>ol>li>:last-child{margin-bottom:1.25em}.prose ol ol,.prose ol ul,.prose ul ol,.prose ul ul{margin-top:.75em;margin-bottom:.75em}.prose h2+*,.prose h3+*,.prose h4+*,.prose hr+*{margin-top:0}.prose thead th:first-child{padding-left:0}.prose thead th:last-child{padding-right:0}.prose tbody td:first-child{padding-left:0}.prose tbody td:last-child{padding-right:0}.prose>:first-child{margin-top:0}.prose>:last-child{margin-bottom:0}.bg-black{--tw-bg-opacity:1;background-color:rgba(0,0,0,var(--tw-bg-opacity))}.rounded-lg{border-radius:.5rem}.border{border-width:1px}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.table{display:table}.grid{display:grid}.hidden{display:none}.font-semibold{font-weight:600}.font-bold{font-weight:700}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.leading-loose{line-height:2}.m-1{margin:.25rem}.my-1{margin-top:.25rem;margin-bottom:.25rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-4{margin-bottom:1rem}.mt-8{margin-top:2rem}.mb-12{margin-bottom:3rem}.max-w-md{max-width:28rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.pt-8{padding-top:2rem}.pb-12{padding-bottom:3rem}.fixed{position:fixed}.absolute{position:absolute}.resize{resize:both}*{--tw-shadow:0 0 transparent;--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 transparent;--tw-ring-shadow:0 0 transparent}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity:1;color:rgba(55,65,81,var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.text-pink-400{--tw-text-opacity:1;color:rgba(244,114,182,var(--tw-text-opacity))}.text-cyan-500{--tw-text-opacity:1;color:rgba(6,182,212,var(--tw-text-opacity))}.uppercase{text-transform:uppercase}.visible{visibility:visible}.w-1{width:.25rem}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.transform{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transition{transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}.filter{--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.invert{--tw-invert:invert(100%)}.funky-underline{display:inline-block;position:relative}.funky-underline:before{--underline-color:#22d3ee;position:absolute;bottom:-1px;left:-2px;right:-4px;content:"";height:4px;border-radius:99999px;background:var(--underline-color);transform:rotate(-2deg)}:root{--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-400:#9ca3af;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-800:#1f2937;--gray-900:#111827;--cyan-400:#22d3ee;--cyan-500:#06b6d4}.prose a{text-decoration:none}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:.92em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:16px 0 32px;overflow:auto;border:1px solid var(--gray-200);background:var(--gray-50);border-radius:4px}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:none}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.24.84"/><title data-react-helmet="true">Beautifully Animate Points with WebGL and regl - Peter Beshai</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,400i,500,600,700" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Learn how to draw and smoothly animate 100,000 points in a web browser with WebGL and regl."/><meta data-react-helmet="true" name="twitter:description" content="Learn how to draw and smoothly animate 100,000 points in a web browser with WebGL and regl."/><meta data-react-helmet="true" property="og:description" content="Learn how to draw and smoothly animate 100,000 points in a web browser with WebGL and regl."/><meta data-react-helmet="true" name="keywords" content="dataviz, data visualization, creative coding, generative art, nba, basketball"/><meta data-react-helmet="true" name="twitter:site" content="@pbesh"/><meta data-react-helmet="true" name="twitter:creator" content="@pbesh"/><meta data-react-helmet="true" property="og:title" content="Beautifully Animate Points with WebGL and regl"/><meta data-react-helmet="true" property="twitter:title" content="Beautifully Animate Points with WebGL and regl"/><meta data-react-helmet="true" property="og:url" content="https://peterbeshai.com/blog/2017-05-26-beautifully-animate-points-with-webgl-and-regl/"/><meta data-react-helmet="true" property="og:image" content="https://peterbeshai.com/static/a95c8b157796ece752d4af68b20c0db1/a4446/regl_particles_header.jpg"/><meta data-react-helmet="true" name="twitter:image" content="https://peterbeshai.com/static/a95c8b157796ece752d4af68b20c0db1/a4446/regl_particles_header.jpg"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><link rel="icon" href="/favicon-32x32.png?v=8eada2f2c54a980a0d0d715a284fca9b" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#000000"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><style data-styled="dgrgPo bRzELH lcczCA gofAlC krNbLw liYjay cgJpCM hRIHo hJIQXL eiraze iZTvUI gQsBqH" data-styled-version="4.4.1">
/* sc-component-id: core__Box-eqpeba-0 */
.lcczCA{margin-left:auto;margin-right:auto;padding:16px;max-width:65ch;}.gofAlC{margin-top:128px;}.krNbLw{margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:64px;padding-bottom:64px;}
/* sc-component-id: core__Flex-eqpeba-1 */
.dgrgPo{margin-top:16px;margin-bottom:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}
/* sc-component-id: core__Text-eqpeba-2 */
.gQsBqH{text-align:center;}
/* sc-component-id: core__Header-eqpeba-3 */
.liYjay{margin:0px;margin-bottom:8px;font-size:27px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;color:#1f2937;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;line-height:1.15;-webkit-letter-spacing:-0.01em;-moz-letter-spacing:-0.01em;-ms-letter-spacing:-0.01em;letter-spacing:-0.01em;}
/* sc-component-id: core__StyledLink-eqpeba-5 */
.eiraze{color:#374151;border-bottom:2px solid #e5e7eb;-webkit-text-decoration:none;text-decoration:none;background:transparent;-webkit-transition:0.2s background linear,0.2s border-color linear;transition:0.2s background linear,0.2s border-color linear;} .eiraze:hover{color:#1f2937;background:#e3fafc;border-color:#99e9f2;}
/* sc-component-id: core__Image-eqpeba-7 */
.iZTvUI{margin:0px;margin-left:auto;margin-right:auto;display:block;max-width:100%;height:auto;}
/* sc-component-id: core__InlineList-eqpeba-11 */
.cgJpCM{margin-bottom:8px;color:#4b5563;list-style-type:none;list-style-type:none;padding-left:0;}.hRIHo{list-style-type:none;padding-left:0;}
/* sc-component-id: core__InlineListItem-eqpeba-12 */
.hJIQXL{margin-right:16px;display:inline-block;} .hJIQXL:last-child{margin-right:0;} .hJIQXL::before{content:'•';color:#d1d5db;margin-right:16px;} .hJIQXL:first-child::before{content:'';margin-right:0;}
/* sc-component-id: layout___StyledText-sc-1yov7wq-0 */
.bRzELH{padding-left:8px;padding-right:8px;font-size:16px;color:#ffffff;background-color:#000000;font-weight:700;border-radius:5px;box-shadow:3px 4px #3bc9db;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:box-shadow 200ms;transition:box-shadow 200ms;} .bRzELH:hover{box-shadow:5px 6px #3bc9db;} .bRzELH:active{box-shadow:2px 3px #3bc9db;}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-06a9210293dd0d2a2358.js"/><link as="script" rel="preload" href="/framework-d80f7338bc29523a5c3b.js"/><link as="script" rel="preload" href="/app-fcd7ff88a19f1bf11c6c.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/commons-16a344fd9551feb818bd.js"/><link as="script" rel="preload" href="/21b0c71395f743ee87503268ff5f3f467b604f32-88a5d176af816359574b.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-0d55bb857b27ef483d4e.js"/><link as="fetch" rel="preload" href="/page-data/blog/2017-05-26-beautifully-animate-points-with-webgl-and-regl/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="core__Box-eqpeba-0 core__Flex-eqpeba-1 dgrgPo"><a bg="black" color="white" px="2" font-size="1" font-weight="700" class="core__Box-eqpeba-0 core__Text-eqpeba-2 layout___StyledText-sc-1yov7wq-0 bRzELH" href="/">Peter Beshai</a></div><div class="core__Box-eqpeba-0 lcczCA"><h2 font-size="4" font-weight="bold" font-family="header" color="gray.8" letter-spacing="-0.01em" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 liYjay">Beautifully Animate Points with WebGL and regl</h2><ul color="gray.6" class="core__Box-eqpeba-0 core__List-eqpeba-10 core__InlineList-eqpeba-11 cgJpCM"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL">May 26, 2017</li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL">13 min read</li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://bl.ocks.org/pbeshai/5309144c8a5faa3dfec5401cc850c7b5" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Demo</a></li></ul><div class="prose"><div><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:700px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:52%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABwJ1iMQf/xAAWEAADAAAAAAAAAAAAAAAAAAAAICH/2gAIAQEAAQUCIv8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGxAAAQQDAAAAAAAAAAAAAAAAMQABIWERIEH/2gAIAQEAAT8h5aBoxacwNP/aAAwDAQACAAMAAAAQLN//xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQMBAT8QTZ//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCn/8QAHBABAAIBBQAAAAAAAAAAAAAAAQARECFBUXGR/9oACAEBAAE/EKHTfKNz9F3CDOqbOf/Z&#x27;);background-size:cover;display:block"></span>
  <img display="block" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI gatsby-resp-image-image" alt="Screenshot of regl animation example" title="Screenshot of regl animation example" src="/static/a95c8b157796ece752d4af68b20c0db1/36dbb/regl_particles_header.jpg" srcSet="/static/a95c8b157796ece752d4af68b20c0db1/42c5d/regl_particles_header.jpg 175w, /static/a95c8b157796ece752d4af68b20c0db1/ccd71/regl_particles_header.jpg 350w, /static/a95c8b157796ece752d4af68b20c0db1/36dbb/regl_particles_header.jpg 700w, /static/a95c8b157796ece752d4af68b20c0db1/1fe05/regl_particles_header.jpg 960w" sizes="(max-width: 700px) 100vw, 700px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p>
<p>I&#x27;ve got a fever, and the only prescription is more points dancing across my screen. In a previous blog post, I covered <a href="https://bocoup.com/blog/smoothly-animate-thousands-of-points-with-html5-canvas-and-d3" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">how to animate thousands of points using HTML5 canvas and d3</a>, but that approach doesn&#x27;t scale too well beyond 10,000 points. Perhaps you can push it to 20,000 if you don&#x27;t mind dropping a frame here or there, but if you <em>need</em> that buttery smoothness, you&#x27;re going to want to switch from the 2D canvas to using WebGL. And who doesn&#x27;t need buttery smoothness?</p>
<p>Now I know what you&#x27;re thinking, WebGL? I know what <em>Web</em> is, but that GL business? Sounds terrifying. And for good reason, it&#x27;s a damn nightmare in here, but hey we <em>need</em> more points! We can&#x27;t give up now. Luckily, a <a href="https://uber.github.io/deck.gl/#/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">few</a> <a href="https://threejs.org/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">brave</a> <a href="http://www.pixijs.com/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">souls</a> have written abstractions on top of WebGL to make it easier to work with. In this post, I&#x27;ll explore using <a href="http://regl.party/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">regl</a>, one such library by <a href="https://github.com/mikolalysenko" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Mikola Lysenko</a> to help do the heavy lifting.</p>
<p>Take note that I am a data visualization guy, not a 3D graphics guy, so my approach is based on my experience in that area.</p>
<p>Quick links to all 4 demos as blocks:</p>
<ul>
<li><a href="https://bl.ocks.org/pbeshai/28c7f3acdde4ca5a13854f06c5d7e334" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Drawing 100,000 points in regl</a></li>
<li><a href="https://bl.ocks.org/pbeshai/5309144c8a5faa3dfec5401cc850c7b5" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Animate 100,000 points with regl - I</a></li>
<li><a href="https://bl.ocks.org/pbeshai/51d05995c5410a52116f89738144c622" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Animate 100,000 points with regl - II</a></li>
<li><a href="https://bl.ocks.org/pbeshai/66f1a837ec33f787dace43e1b5039e31" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Animate 100,000 points with regl - III</a></li>
</ul>
<h2>So, why do we need WebGL anyway?</h2>
<p>The problem with sticking with the 2D canvas is that we typically have a big old for loop iterating over each point and drawing it on screen with something like <code class="language-text">context.fillRect()</code>. Since we want to maintain frame rate of 60 frames per second, we&#x27;re going to need to complete all of our updating and drawing before the browser wants to draw the next frame. With 60 frames a second, that works out to less than 17ms to do all of our calculations and updates. Once we get enough iterations in our loop, we&#x27;re going to exceed that threshold and end up dropping frames occasionally, making for a jumpy and far less satisfying animation.</p>
<p>By switching to using WebGL, we can pass over some of the effort spent iterating over points from the CPU to the GPU. The way we do that is with shaders. Luckily for us (perhaps), regl makes it really easy to dive right in and start playing around with them.</p>
<h2>Super Simple Shader Primer</h2>
<p>Look, I&#x27;m no WebGL or shader expert, I just want swarms of points to storm across my screen. If you really want to learn how shaders work, you should probably read some other resource like the <a href="https://thebookofshaders.com/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Book of Shaders</a>. Alternatively, you can stare at the examples at <a href="http://regl.party/examples" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">regl.party</a> while banging your head against the wall until it begins to make a little sense (like I did).</p>
<p>With that disclaimer in mind, here&#x27;s a basic rundown. You&#x27;ve got two types of shaders: a <strong>vertex</strong> shader and a <strong>fragment</strong> shader. Shaders are just programs that run on the GPU, typically to produce some graphical output. A vertex shader updates a special value called <code class="language-text">gl_Position</code> that determines where a vertex is positioned on screen. A fragment shader updates a special value called <code class="language-text">gl_FragColor</code> that determines which color a pixel will be. Vertex shaders are called for <em>all points</em> or vertices passed in and fragment shaders for <em>all pixels</em>.</p>
<p>That covers a <em>very</em> basic (and almost my complete) understanding of shaders. Disappointing, right? I know and I&#x27;m sorry. Turns out, however, that&#x27;s almost all you need to know to get started, so let&#x27;s try drawing with them before we get to animating.</p>
<h2>Drawing 100,000 points with shaders in regl</h2>
<p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:700px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:52%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAEDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHDlrMgEJ//xAAXEAEBAQEAAAAAAAAAAAAAAAABAgAg/9oACAEBAAEFApBzM8//xAAWEQEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQMBAT8BTZ//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwFJ/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGBABAAMBAAAAAAAAAAAAAAAAAQAgITH/2gAIAQEAAT8hY2GMY9p//9oADAMBAAIAAwAAABD0D//EABYRAQEBAAAAAAAAAAAAAAAAAAEREP/aAAgBAwEBPxBWrn//xAAWEQEBAQAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8QRbc//8QAGRABAQEBAQEAAAAAAAAAAAAAAREAIRAx/9oACAEBAAE/EOozUIXAFHmHKz6+f//Z&#x27;);background-size:cover;display:block"></span>
  <img display="block" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI gatsby-resp-image-image" alt="Screenshot of regl drawing example" title="Screenshot of regl drawing example" src="/static/ff549e6400cd9e33cff863379997cf43/36dbb/regl_draw.jpg" srcSet="/static/ff549e6400cd9e33cff863379997cf43/42c5d/regl_draw.jpg 175w, /static/ff549e6400cd9e33cff863379997cf43/ccd71/regl_draw.jpg 350w, /static/ff549e6400cd9e33cff863379997cf43/36dbb/regl_draw.jpg 700w, /static/ff549e6400cd9e33cff863379997cf43/1fe05/regl_draw.jpg 960w" sizes="(max-width: 700px) 100vw, 700px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p>
<p>Here&#x27;s a link to <a href="https://bl.ocks.org/pbeshai/28c7f3acdde4ca5a13854f06c5d7e334" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">a working example</a>. If you want to take a look at all the example code at once, check it out.</p>
<p>Now before we get to anything too fancy, let&#x27;s start by defining a few constants and creating our &quot;dataset&quot; of 100,000 points.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> numPoints <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>

<span class="token comment">// the size of the points we draw on screen</span>
<span class="token keyword">const</span> pointWidth <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">// dimensions of the viewport we are drawing in</span>
<span class="token keyword">const</span> width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
<span class="token keyword">const</span> height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

<span class="token comment">// random number generator from d3-random</span>
<span class="token keyword">const</span> rng <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">randomNormal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create initial set of points</span>
<span class="token keyword">const</span> points <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>numPoints<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function">rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> width<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  y<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function">rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> height<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Ok, so we have some points. Notice anything a bit strange? The colors are arrays!</p>
<p>Colors in WebGL are formatted as arrays of length four (red, green, blue, alpha) with values ranging from 0 to 1 instead of their typical string format used in HTML and CSS. The code above produces points with colors ranging from rgb(0, 0, 0) to rgb(0, 255, 0). Since we&#x27;re not dealing with alpha in this example, I&#x27;ve excluded the fourth value from the array (we&#x27;ll fill it in as <code class="language-text">1</code> later).</p>
<p>The x and y values that we specified will range from 0 to <code class="language-text">width</code> and 0 to <code class="language-text">height</code>, also known as pixel space. This coordinate system is what we&#x27;re used to when working with normal canvas or svg, but in WebGL everything lives in normalized device coordinates, which is a fancy way of saying the top left corner is at (-1, 1) and the bottom right corner is at (1, -1). We&#x27;ll keep the <code class="language-text">width</code> and <code class="language-text">height</code> variables around so we can scale our x and y positions appropriately in our shader.</p>
<h3>The regl Draw Loop</h3>
<p>So we have a collection of points, now let&#x27;s set up the regl drawing loop before diving into the nitty gritty of the shaders.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// start the regl draw loop</span>
regl<span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// clear the buffer</span>
  regl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// background color (black)</span>
    color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    depth<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// draw the points using our created regl func</span>
  <span class="token comment">// note that the arguments are available via `regl.prop`.</span>
  <span class="token function">drawPoints</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// we&#x27;ll get to this function in a moment!</span>
    pointWidth<span class="token punctuation">,</span>
    stageWidth<span class="token operator">:</span> width<span class="token punctuation">,</span>
    stageHeight<span class="token operator">:</span> height<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Not much going on here: we clear the background with the color black and then we call <code class="language-text">drawPoints</code> with a few properties, but with this code we now have a loop running 60 times a second and attempting to draw points on the screen.</p>
<h3>The drawPoints Function (aka <em>Shader Magic</em>)</h3>
<p>All right, since regl is really focused around shaders, all of the work comes out when writing shader code. We can create our <code class="language-text">drawPoints</code> function, which will essentially connect all the information to our shaders in a way WebGL understands. Thanks regl! I <em>really</em> didn&#x27;t want to do that myself.</p>
<p>The basic structure looks like this:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> drawPoints <span class="token operator">=</span> <span class="token function">regl</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  frag<span class="token operator">:</span> <span class="token string">&#x27;the fragment shader string (filled in later)&#x27;</span><span class="token punctuation">,</span>
  vert<span class="token operator">:</span> <span class="token string">&#x27;the vertex shader string (filled in later)&#x27;</span><span class="token punctuation">,</span>

  attributes<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// each of these gets mapped to a single entry for each of</span>
    <span class="token comment">// the points. this means the vertex shader will receive</span>
    <span class="token comment">// just the relevant value for a given point.</span>
    position<span class="token operator">:</span> points<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span>x<span class="token punctuation">,</span> d<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> points<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  uniforms<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// by using `regl.prop` to pass these in, we can specify</span>
    <span class="token comment">// them as arguments to our drawPoints function</span>
    pointWidth<span class="token operator">:</span> regl<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&#x27;pointWidth&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// regl actually provides these as viewportWidth and</span>
    <span class="token comment">// viewportHeight but I am using these outside and I want</span>
    <span class="token comment">// to ensure they are the same numbers, so I am explicitly</span>
    <span class="token comment">// passing them in.</span>
    stageWidth<span class="token operator">:</span> regl<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&#x27;stageWidth&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    stageHeight<span class="token operator">:</span> regl<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&#x27;stageHeight&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// specify the number of points to draw</span>
  count<span class="token operator">:</span> points<span class="token punctuation">.</span>length<span class="token punctuation">,</span>

  <span class="token comment">// specify that each vertex is a point (not part of a mesh)</span>
  primitive<span class="token operator">:</span> <span class="token string">&#x27;points&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Let&#x27;s breakdown that structure above.</p>
<ul>
<li><strong>frag</strong>: This is where we&#x27;ll put the fragment shader code. It is passed in just as a string.</li>
<li><strong>vert</strong>: This is where we&#x27;ll put the vertex shader code, also a string.</li>
<li><strong>attributes</strong>: Here we pass data into the drawPoints function definition. A single entry from each of the arrays specified here is passed to the vertex shader, corresponding with the point it is drawing. So each vertex shader will receive a <code class="language-text">position</code> array with two entries <code class="language-text">[x, y]</code> (note: WebGL calls an array with 2 entries a <code class="language-text">vec2</code> for vector of length 2).</li>
<li><strong>uniforms</strong>: These are values that are the same for all points. Note that we use <code class="language-text">regl.prop</code> here, which makes it so we can change these values by modifying the argument to the <code class="language-text">drawPoints</code> function accordingly when we call it from the draw loop.</li>
<li><strong>count</strong>: The total number of points being drawn. I believe this is important for divvying up the attributes and knowing how many vertices to draw.</li>
<li><strong>primitive</strong>: We specify that each vertex should be drawn as a point, as opposed to all being part of a single mesh. Using <code class="language-text">point</code> is a great choice for particle system effects like what we&#x27;re going for here.</li>
</ul>
<p>Ok, with all that aside, let&#x27;s dive into the shaders.</p>
<h4>The Fragment Shader</h4>
<p>To specify the fragment shader, we write it as a multi-line string. We&#x27;ll keep this one as simple as we can and just set the pixel color to whatever the vertex shader passed in.</p>
<div class="gatsby-highlight" data-language="clike"><pre class="language-clike"><code class="language-clike"><span class="token comment">// set the precision of floating point numbers</span>
precision highp float<span class="token punctuation">;</span>

<span class="token comment">// this value is populated by the vertex shader</span>
varying vec3 fragColor<span class="token punctuation">;</span>

void <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// gl_FragColor is a special variable that holds the color</span>
  <span class="token comment">// of a pixel</span>
  gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>fragColor<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Note that <code class="language-text">varying</code> basically means the vertex shader populates the value of this variable. Also recall how we only stored colors as arrays of length 3 (vec3), so we append a 1 to the end for the alpha channel.</p>
<h4>The Vertex Shader</h4>
<p>The vertex shader is a bit more complex, but the basics are shown below:</p>
<div class="gatsby-highlight" data-language="clike"><pre class="language-clike"><code class="language-clike"><span class="token comment">// per vertex attributes</span>
attribute vec2 position<span class="token punctuation">;</span>
attribute vec3 color<span class="token punctuation">;</span>

<span class="token comment">// variables to send to the fragment shader</span>
varying vec3 fragColor<span class="token punctuation">;</span>

<span class="token comment">// values that are the same for all vertices</span>
uniform float pointWidth<span class="token punctuation">;</span>
uniform float stageWidth<span class="token punctuation">;</span>
uniform float stageHeight<span class="token punctuation">;</span>

void <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// update the size of a point based on the prop pointWidth</span>
  gl_PointSize <span class="token operator">=</span> pointWidth<span class="token punctuation">;</span>

  <span class="token comment">// send color to the fragment shader</span>
  fragColor <span class="token operator">=</span> color<span class="token punctuation">;</span>

  <span class="token comment">// gl_Position is a special variable that holds the position</span>
  <span class="token comment">// of a vertex.</span>
  gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>First, we update <code class="language-text">gl_PointSize</code>, a special value that determines the size points are rendered on screen based on our property <code class="language-text">pointWidth</code>. Then we save the attribute <code class="language-text">color</code> into the varying <code class="language-text">fragColor</code> so that the fragment shader can read its value since it does not have access to attributes. Finally, we update <code class="language-text">gl_Position</code> to indicate where the vertex is positioned.</p>
<p>Now if you&#x27;ll recall, the points in WebGL space are not the same as in normal screen pixel space-- they range from (-1, 1) to (1, -1). Since we laid out our point positions in pixel space, we&#x27;ll need to normalize them in our shader. Here&#x27;s the full code including normalization:</p>
<div class="gatsby-highlight" data-language="clike"><pre class="language-clike"><code class="language-clike"><span class="token comment">// per vertex attributes</span>
attribute vec2 position<span class="token punctuation">;</span>
attribute vec3 color<span class="token punctuation">;</span>

<span class="token comment">// variables to send to the fragment shader</span>
varying vec3 fragColor<span class="token punctuation">;</span>

<span class="token comment">// values that are the same for all vertices</span>
uniform float pointWidth<span class="token punctuation">;</span>
uniform float stageWidth<span class="token punctuation">;</span>
uniform float stageHeight<span class="token punctuation">;</span>

<span class="token comment">// helper function to transform from pixel space to normalized</span>
<span class="token comment">// device coordinates (NDC). In NDC (0,0) is the middle,</span>
<span class="token comment">// (-1, 1) is the top left and (1, -1) is the bottom right.</span>
vec2 <span class="token function">normalizeCoords</span><span class="token punctuation">(</span>vec2 position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// read in the positions into x and y vars</span>
  float x <span class="token operator">=</span> position<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  float y <span class="token operator">=</span> position<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">vec2</span><span class="token punctuation">(</span>
    <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">/</span> stageWidth<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// invert y to treat [0,0] as bottom left in pixel space</span>
    <span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">/</span> stageHeight<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

void <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// update the size of a point based on the prop pointWidth</span>
  gl_PointSize <span class="token operator">=</span> pointWidth<span class="token punctuation">;</span>

  <span class="token comment">// send color to the fragment shader</span>
  fragColor <span class="token operator">=</span> color<span class="token punctuation">;</span>

  <span class="token comment">// scale to normalized device coordinates</span>
  <span class="token comment">// gl_Position is a special variable that holds the position</span>
  <span class="token comment">// of a vertex</span>
  gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">normalizeCoords</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>That&#x27;s right, you can create helper functions in shaders (like we did with <code class="language-text">normalizeCoords()</code> above) and call them within your <code class="language-text">main()</code> function. Pretty cool stuff.</p>
<p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:700px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:52%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAEDBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHDlrMgEJ//xAAXEAEBAQEAAAAAAAAAAAAAAAABAgAg/9oACAEBAAEFApBzM8//xAAWEQEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQMBAT8BTZ//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwFJ/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGBABAAMBAAAAAAAAAAAAAAAAAQAgITH/2gAIAQEAAT8hY2GMY9p//9oADAMBAAIAAwAAABD0D//EABYRAQEBAAAAAAAAAAAAAAAAAAEREP/aAAgBAwEBPxBWrn//xAAWEQEBAQAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8QRbc//8QAGRABAQEBAQEAAAAAAAAAAAAAAREAIRAx/9oACAEBAAE/EOozUIXAFHmHKz6+f//Z&#x27;);background-size:cover;display:block"></span>
  <img display="block" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI gatsby-resp-image-image" alt="Screenshot of regl drawing example" title="Screenshot of regl drawing example" src="/static/ff549e6400cd9e33cff863379997cf43/36dbb/regl_draw.jpg" srcSet="/static/ff549e6400cd9e33cff863379997cf43/42c5d/regl_draw.jpg 175w, /static/ff549e6400cd9e33cff863379997cf43/ccd71/regl_draw.jpg 350w, /static/ff549e6400cd9e33cff863379997cf43/36dbb/regl_draw.jpg 700w, /static/ff549e6400cd9e33cff863379997cf43/1fe05/regl_draw.jpg 960w" sizes="(max-width: 700px) 100vw, 700px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p>
<p>At this point, we have all the necessary parts to draw 100,000 points on screen with regl and shaders. Check out the <a href="https://bl.ocks.org/pbeshai/28c7f3acdde4ca5a13854f06c5d7e334" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">demo and full code here</a>.</p>
<h2>And Now Animate</h2>
<img display="block" alt="GIF of animation example" src="/148207c088c9a754f0f4ce02b8e6992a/regl_particles_anim1.gif" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI w-full"/>
<p>Here&#x27;s the <a href="https://bl.ocks.org/pbeshai/5309144c8a5faa3dfec5401cc850c7b5" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">live demo and full source code</a> to get this initial animation working.</p>
<p>So, getting started drawing 100,000 points was pretty complicated. Luckily the jump from there to animating is relatively small. At this point we already have the GPU normalizing positions of the points and drawing them on screen. And we have a loop running just waiting to animate, so what&#x27;s our strategy going to be?</p>
<p>I&#x27;m going to take a very similar approach to what I did for <a href="https://bocoup.com/blog/smoothly-animate-thousands-of-points-with-html5-canvas-and-d3" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">animating thousands of points on canvas</a>, except this time all the interpolation of position is going to happen in a shader so we can use the GPU.</p>
<p>The basic animation process is:</p>
<ol>
<li>Store the current position of a point as its start position</li>
<li>Run a layout function on the points to get their new positions and then store them as their end positions</li>
<li>Tell the shader how far through the animation we are so it knows where to interpolate to</li>
<li>Switch layouts after our animation completes</li>
</ol>
<h3>Laying out the Points</h3>
<p>A layout algorithm can be any function that sets the <code class="language-text">x</code> and <code class="language-text">y</code> attribute on our point objects. The reason I&#x27;ve taken this approach is that it is a fairly common style to find in layout algorithms already made for <a href="https://d3js.org/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">D3</a>, the industry standard library for data visualization on the web. For simplicity in these examples, I&#x27;ll also set <code class="language-text">color</code> so we can animate it easily. Here&#x27;s an example layout algorithm that randomly positions points:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">blueNormalLayout</span><span class="token punctuation">(</span><span class="token parameter">points</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// random number generator based on a normal distribution</span>
  <span class="token comment">// with mean = 0, std dev = 0.15</span>
  <span class="token keyword">const</span> rng <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">randomNormal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// set the x and y attributes</span>
    d<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> width<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    d<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> height<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// blue-green color</span>
    d<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now when we animate between the points, all we need to do is keep track of their start position (let&#x27;s call it <code class="language-text">sx, sy</code>) or where they currently are, and their end position (<code class="language-text">tx, ty</code>) based on wherever their new layout places them.</p>
<p>This can be done with the following code:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// make previous end the new beginning</span>
points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  d<span class="token punctuation">.</span>sx <span class="token operator">=</span> d<span class="token punctuation">.</span>tx<span class="token punctuation">;</span>
  d<span class="token punctuation">.</span>sy <span class="token operator">=</span> d<span class="token punctuation">.</span>ty<span class="token punctuation">;</span>
  d<span class="token punctuation">.</span>colorStart <span class="token operator">=</span> d<span class="token punctuation">.</span>colorEnd<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// layout points, updating x, y, and color attributes</span>
<span class="token function">layout</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// copy layout x, y, and color to end values</span>
points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  d<span class="token punctuation">.</span>tx <span class="token operator">=</span> d<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
  d<span class="token punctuation">.</span>ty <span class="token operator">=</span> d<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
  d<span class="token punctuation">.</span>colorEnd <span class="token operator">=</span> d<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The important part here is now our points contain both their start and end positions, not just their current position. This will allow the shader to interpolate between them easily. The basic shape of a point object is as follows:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">{
  sx: start x position - number between 0 and width,
  sy: start y position - number between 0 and height,
  colorStart: array with 3 entries between 0 and 1,
  tx: end x position - number between 0 and width,
  ty: end y position - number between 0 and height,
  colorEnd: array with 3 entries between 0 and 1
}</code></pre></div>
<h3>Updating regl.frame to Animate</h3>
<p>We need to update our callback in <code class="language-text">regl.frame</code> so that it gets the duration and start time of the animation, and knows when it can switch to the next animation. The changes are relatively simple: we keep track of the time when the animation began so we can compute time elapsed, we pass in duration and start time as new props to our drawPoints function, and we check if we&#x27;ve exceeded the duration of the animation and if so, switch to the next layout.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> startTime <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// in seconds</span>
regl<span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> time <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// keep track of start time so we can get time elapsed</span>
  <span class="token comment">// this is important since time doesn&#x27;t reset when starting</span>
  <span class="token comment">// new animations</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>startTime <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    startTime <span class="token operator">=</span> time<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// clear the buffer</span>
  regl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// background color (black)</span>
    color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    depth<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// draw the points using our created regl func</span>
  <span class="token comment">// note that the arguments are available via `regl.prop`.</span>
  <span class="token function">drawPoints</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    pointWidth<span class="token punctuation">,</span>
    stageWidth<span class="token operator">:</span> width<span class="token punctuation">,</span>
    stageHeight<span class="token operator">:</span> height<span class="token punctuation">,</span>

    <span class="token comment">// here we pass in the new props:</span>
    duration<span class="token punctuation">,</span>
    startTime<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// if we have exceeded the maximum duration, move on to the</span>
  <span class="token comment">// next animation</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">-</span> startTime <span class="token operator">&gt;</span> <span class="token punctuation">(</span>duration <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">switchToNextAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// see live demo code for details</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3>Updating drawPoints for Animation</h3>
<p>Previously we had attributes that stored the <em>current</em> position and color of each point, but now we want to work with both their start and end values. To do so, we&#x27;ll modify our attributes as follows:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">attributes<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// each of these gets mapped to a single entry for each of</span>
  <span class="token comment">// the points. this means the vertex shader will receive</span>
  <span class="token comment">// just the relevant value for a given point.</span>
  positionStart<span class="token operator">:</span> points<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span>sx<span class="token punctuation">,</span> d<span class="token punctuation">.</span>sy<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  positionEnd<span class="token operator">:</span> points<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span>tx<span class="token punctuation">,</span> d<span class="token punctuation">.</span>ty<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  colorStart<span class="token operator">:</span> points<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>colorStart<span class="token punctuation">)</span><span class="token punctuation">,</span>
  colorEnd<span class="token operator">:</span> points<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>colorEnd<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>We&#x27;ll also need a couple new uniforms that contain information about the animation as a whole. In particular, we care about how much time has elapsed between the current frame and the beginning of the animation and how long the entire animation should take.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">uniforms<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// by using `regl.prop` to pass these in, we can specify them</span>
  <span class="token comment">// as arguments to our drawPoints function</span>
  pointWidth<span class="token operator">:</span> regl<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&#x27;pointWidth&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// regl actually provides these as viewportWidth and</span>
  <span class="token comment">// viewportHeight but I am using these outside and I want to</span>
  <span class="token comment">// ensure they are the same numbers, so I am explicitly</span>
  <span class="token comment">// passing them in.</span>
  stageWidth<span class="token operator">:</span> regl<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&#x27;stageWidth&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  stageHeight<span class="token operator">:</span> regl<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&#x27;stageHeight&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  duration<span class="token operator">:</span> regl<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&#x27;duration&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// time in ms since the prop startTime (i.e. time elapsed)</span>
  <span class="token comment">// note that `time` is passed by regl whereas `startTime`</span>
  <span class="token comment">// is a prop passed to the drawPoints function.</span>
  <span class="token function-variable function">elapsed</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> time <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> startTime <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">(</span>time <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>Here, <code class="language-text">duration</code> will be another prop we pass in that represents the time for the animation to run in milliseconds. <code class="language-text">elapsed</code> is a bit trickier - its value will be computed for each frame based on the function specified. The first argument <code class="language-text">time</code> is populated by regl itself, while the second argument <code class="language-text">startTime</code> is a prop that we are going to pass in. Note that time in regl is computed in seconds, so we multiply by 1000 to get milliseconds.</p>
<h3>Update the Shader for Animation</h3>
<p>We&#x27;ve reached the point where we have to dive back into our shader to update it to animate the points. Luckily for us, the changes are relatively small. In fact, we do not have to change our fragment shader at all! However, the vertex shader needs to be updated to know how far through the animation it is, and then to interpolate the start and end positions and colors accordingly.</p>
<p>Since we have <code class="language-text">elapsed</code> and <code class="language-text">duration</code> being passed as uniforms, we can compute how far through the animation we are by simply dividing them: <code class="language-text">elapsed / duration</code> (and maxing out at 1). We can then use the amazingly useful <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/mix.xhtml" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">mix(a, b)</a> function which linear interpolates any two values -- even vectors -- to figure out our current positions and colors. Let&#x27;s see how this shakes out inside our main() function:</p>
<div class="gatsby-highlight" data-language="clike"><pre class="language-clike"><code class="language-clike"><span class="token comment">// number between 0 and 1 indicating how far through the</span>
<span class="token comment">// animation this vertex is.</span>
float t <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> elapsed <span class="token operator">/</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// interpolate position</span>
vec2 position <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>positionStart<span class="token punctuation">,</span> positionEnd<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// interpolate and send color to the fragment shader</span>
fragColor <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>colorStart<span class="token punctuation">,</span> colorEnd<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Besides declaring the new variables at the top of the shader, those are the only changes we have to make! What a beautiful day.</p>
<p>Sadly, if you looked at the animation at this point, it would be a bit boring since we left all the magic of easing out. There&#x27;s this amazing module system of pre-built shader helpers called <a href="https://github.com/stackgl/glslify" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">glslify</a> that contains <a href="https://github.com/stackgl/glsl-easings" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">a bunch of easing functions</a> you can drop into your code, but for now we&#x27;ll write our own. Let&#x27;s take the cubic-in-out easing code from <a href="https://github.com/d3/d3-ease" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">d3-ease</a> and use it to create a new function in our shader:</p>
<div class="gatsby-highlight" data-language="clike"><pre class="language-clike"><code class="language-clike"><span class="token comment">// helper function to handle cubic easing (copied from d3)</span>
<span class="token comment">// note there are premade ease functions available via glslify.</span>
float <span class="token function">easeCubicInOut</span><span class="token punctuation">(</span>float t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  t <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
  t <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;=</span> <span class="token number">1.0</span> <span class="token operator">?</span> t <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token punctuation">:</span> <span class="token punctuation">(</span>t <span class="token operator">-</span><span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">+</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>

  <span class="token comment">// for simplicity, max at 1 here</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&gt;</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>All we have to do now is apply that function to our <code class="language-text">t</code> value and we&#x27;ll have some smoothly eased animation taking place and we&#x27;re done! Here&#x27;s the full animation vertex shader:</p>
<div class="gatsby-highlight" data-language="clike"><pre class="language-clike"><code class="language-clike"><span class="token comment">// per vertex attributes</span>
attribute vec2 positionStart<span class="token punctuation">;</span>
attribute vec2 positionEnd<span class="token punctuation">;</span>
attribute vec3 colorStart<span class="token punctuation">;</span>
attribute vec3 colorEnd<span class="token punctuation">;</span>

<span class="token comment">// variables to send to the fragment shader</span>
varying vec3 fragColor<span class="token punctuation">;</span>

<span class="token comment">// values that are the same for all vertices</span>
uniform float pointWidth<span class="token punctuation">;</span>
uniform float stageWidth<span class="token punctuation">;</span>
uniform float stageHeight<span class="token punctuation">;</span>
uniform float elapsed<span class="token punctuation">;</span>
uniform float duration<span class="token punctuation">;</span>

<span class="token comment">// helper function to transform from pixel space to normalized</span>
<span class="token comment">// device coordinates (NDC). In NDC (0,0) is middle, (-1, 1)</span>
<span class="token comment">// is the top left and (1, -1) is the bottom right.</span>
vec2 <span class="token function">normalizeCoords</span><span class="token punctuation">(</span>vec2 position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// read in the positions into x and y vars</span>
  float x <span class="token operator">=</span> position<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  float y <span class="token operator">=</span> position<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">vec2</span><span class="token punctuation">(</span>
    <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">/</span> stageWidth<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// invert y since we think [0,0] is bottom left in pixel</span>
    <span class="token comment">// space</span>
    <span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">/</span> stageHeight<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// helper function to handle cubic easing (copied from d3)</span>
<span class="token comment">// note there are premade ease functions available via glslify.</span>
float <span class="token function">easeCubicInOut</span><span class="token punctuation">(</span>float t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  t <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
  t <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;=</span> <span class="token number">1.0</span> <span class="token operator">?</span> t <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token punctuation">:</span> <span class="token punctuation">(</span>t <span class="token operator">-</span><span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">*</span> t <span class="token operator">+</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">&gt;</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

void <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// update the size of a point based on the prop pointWidth</span>
  gl_PointSize <span class="token operator">=</span> pointWidth<span class="token punctuation">;</span>

  <span class="token comment">// number between 0 and 1 indicating how far through the</span>
  <span class="token comment">// animation this vertex is.</span>
  float t<span class="token punctuation">;</span>

  <span class="token comment">// drawing without animation, so show end state immediately</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>duration <span class="token operator">==</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>

  <span class="token comment">// otherwise we are animating, so use cubic easing</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t <span class="token operator">=</span> <span class="token function">easeCubicInOut</span><span class="token punctuation">(</span>elapsed <span class="token operator">/</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// interpolate position</span>
  vec2 position <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>positionStart<span class="token punctuation">,</span> positionEnd<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// interpolate and send color to the fragment shader</span>
  fragColor <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>colorStart<span class="token punctuation">,</span> colorEnd<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// scale to normalized device coordinates</span>
  <span class="token comment">// gl_Position is a special variable that holds the</span>
  <span class="token comment">// position of a vertex</span>
  gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">normalizeCoords</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<img display="block" alt="GIF of animation example" src="/148207c088c9a754f0f4ce02b8e6992a/regl_particles_anim1.gif" class="core__Box-eqpeba-0 core__Image-eqpeba-7 iZTvUI w-full"/>
<p>Once again, here&#x27;s the <a href="https://bl.ocks.org/pbeshai/5309144c8a5faa3dfec5401cc850c7b5" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">live demo and full source code of this animation</a>.</p>
<h2>Conclusion</h2>
<p>So there you have it, simple point based animation in regl. We covered how to draw 100,000 points and a basic approach to animating them. However, with these same ideas, you can do even cooler animations when you start using different layouts.</p>
<p>Here&#x27;s <a href="https://bl.ocks.org/pbeshai/51d05995c5410a52116f89738144c622" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">an example of animating through a set of visually pleasing layouts</a>, similar to what was done in my canvas post:</p>
<div class="giphy-embed" style="width:100%;height:0;padding-bottom:65%;position:relative"><iframe src="https://giphy.com/embed/3o7bu9aq5LuVO52m5O" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowfullscreen=""></iframe></div>
<p>And <a href="https://bl.ocks.org/pbeshai/66f1a837ec33f787dace43e1b5039e31" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">another example that uses actual data values</a> for laying out the points:</p>
<div class="giphy-embed" style="width:100%;height:0;padding-bottom:57%;position:relative"><iframe src="https://giphy.com/embed/3o7bueOHJAxx2l7rck" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowfullscreen=""></iframe></div>
<p>Hope you enjoyed it! Feel free to reach out to me on twitter <a href="https://twitter.com/pbesh" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">@pbesh</a> if you have any questions or comments.</p></div></div><div class="core__Box-eqpeba-0 gofAlC"><div shortname="peter-beshai" config="[object Object]" id="disqus_thread"></div></div></div><div class="core__Box-eqpeba-0 krNbLw"><div class="core__Box-eqpeba-0 core__Text-eqpeba-2 gQsBqH"><ul class="core__Box-eqpeba-0 core__List-eqpeba-10 core__InlineList-eqpeba-11 hRIHo"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="mailto:peter.beshai@gmail.com" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">peter.beshai@gmail.com</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://twitter.com/pbesh" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Twitter</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://twitch.tv/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Twitch</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://github.com/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">GitHub</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://instagram.com/pbeshasketch" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">Instagram</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-12 hJIQXL"><a href="https://www.linkedin.com/in/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-5 eiraze">LinkedIn</a></li></ul></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-55938435-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2017-05-26-beautifully-animate-points-with-webgl-and-regl/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b540199392df4ae4b2b3.js"],"app":["/app-fcd7ff88a19f1bf11c6c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c2832438e0b6a94d149f.js"],"component---src-pages-index-js":["/component---src-pages-index-js-9fd4d7b2f08ac5830f3c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-0d55bb857b27ef483d4e.js"],"component---src-templates-demo-js":["/component---src-templates-demo-js-86292a96b849eb84e1cf.js"]};/*]]>*/</script><script src="/polyfill-b540199392df4ae4b2b3.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-0d55bb857b27ef483d4e.js" async=""></script><script src="/21b0c71395f743ee87503268ff5f3f467b604f32-88a5d176af816359574b.js" async=""></script><script src="/commons-16a344fd9551feb818bd.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-fcd7ff88a19f1bf11c6c.js" async=""></script><script src="/framework-d80f7338bc29523a5c3b.js" async=""></script><script src="/webpack-runtime-06a9210293dd0d2a2358.js" async=""></script></body></html>