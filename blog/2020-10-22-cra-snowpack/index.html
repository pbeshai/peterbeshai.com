<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.66a4be9dcb34d5127632.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:.92em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:16px 0 32px;overflow:auto;border-bottom:2px solid #f1f3f5;background:#fbfbfc;border-radius:4px}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:none}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.24.84"/><title data-react-helmet="true">Use Snowpack for ultra fast dev builds with Create React App - Peter Beshai</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:700|Karla:400,400i,700" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Learn how to modify a create-react-app react app to use snowpack during development for faster rebuilds."/><meta data-react-helmet="true" name="twitter:description" content="Learn how to modify a create-react-app react app to use snowpack during development for faster rebuilds."/><meta data-react-helmet="true" property="og:description" content="Learn how to modify a create-react-app react app to use snowpack during development for faster rebuilds."/><meta data-react-helmet="true" name="keywords" content="data vis, visualization, creative coding, generative art, nba, basketball"/><meta data-react-helmet="true" name="twitter:site" content="@pbesh"/><meta data-react-helmet="true" name="twitter:creator" content="@pbesh"/><meta data-react-helmet="true" property="og:title" content="Use Snowpack for ultra fast dev builds with Create React App"/><meta data-react-helmet="true" property="twitter:title" content="Use Snowpack for ultra fast dev builds with Create React App"/><meta data-react-helmet="true" property="og:url" content="https://peterbeshai.com/blog/2020-10-22-cra-snowpack/"/><meta data-react-helmet="true" property="og:image" content="https://peterbeshai.com/static/f597c6ebb9c1d793892a89c1e3fb678d/35c24/social.png"/><meta data-react-helmet="true" name="twitter:image" content="https://peterbeshai.com/static/f597c6ebb9c1d793892a89c1e3fb678d/35c24/social.png"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><link rel="icon" href="/favicon-32x32.png?v=8eada2f2c54a980a0d0d715a284fca9b" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#000000"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8eada2f2c54a980a0d0d715a284fca9b"/><style data-styled="jlbBry ebIbsV gofAlC krNbLw gQsBqH dzArUp bhvpAY WSIGj senpC zunmK eKUuZz futIAd clizFh iUCFnu cVFjsM" data-styled-version="4.4.1">
/* sc-component-id: sc-global-1926057577 */
html,body,#___gatsby{background-color:#fff;width:100%;height:100%;padding:0;margin:0;color:#000;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:Karla,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;line-height:1.7;font-size:19px;} *{box-sizing:border-box;} #___gatsby > div{height:100%;} img.full-width-image{width:100%;} a{color:#495057;}
/* sc-component-id: core__Box-eqpeba-0 */
.jlbBry{margin-left:auto;margin-right:auto;padding:16px;max-width:800px;}.ebIbsV{margin-bottom:16px;}.gofAlC{margin-top:128px;}.krNbLw{margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:64px;padding-bottom:64px;}
/* sc-component-id: core__Text-eqpeba-2 */
.gQsBqH{text-align:center;}.dzArUp{margin-bottom:32px;margin-top:16px;}
/* sc-component-id: core__Header-eqpeba-3 */
.bhvpAY{margin:0px;font-size:23px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:uppercase;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.WSIGj{margin:0px;font-size:27px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:uppercase;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.senpC{margin:0px;margin-bottom:16px;margin-top:64px;font-size:27px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:none;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}.zunmK{margin:0px;margin-bottom:16px;margin-top:64px;font-size:19px;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-family:'IBM Plex Sans',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:bold;text-transform:none;-webkit-letter-spacing:0.035em;-moz-letter-spacing:0.035em;-ms-letter-spacing:0.035em;letter-spacing:0.035em;}
/* sc-component-id: core__StyledLink-eqpeba-4 */
.iUCFnu{color:#495057;border-bottom:2px solid #e9ecef;-webkit-text-decoration:none;text-decoration:none;background:transparent;-webkit-transition:0.2s background linear,0.2s border-color linear;transition:0.2s background linear,0.2s border-color linear;} .iUCFnu:hover{color:#343a40;background:#e3fafc;border-color:#99e9f2;}
/* sc-component-id: core__List-eqpeba-9 */
.cVFjsM{margin-bottom:32px;margin-top:0px;}
/* sc-component-id: core__InlineList-eqpeba-10 */
.eKUuZz{list-style-type:none;padding-left:0;}.futIAd{color:#868e96;list-style-type:none;list-style-type:none;padding-left:0;}
/* sc-component-id: core__InlineListItem-eqpeba-11 */
.clizFh{margin-right:16px;display:inline-block;} .clizFh:last-child{margin-right:0;} .clizFh::before{content:'•';color:#dee2e6;margin-right:16px;} .clizFh:first-child::before{content:'';margin-right:0;}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-87626a9fc4ca94b3c336.js"/><link as="script" rel="preload" href="/framework-d80f7338bc29523a5c3b.js"/><link as="script" rel="preload" href="/app-69ce7114bdda5fe6dd69.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/commons-47fd07ee46cd5b86e697.js"/><link as="script" rel="preload" href="/21b0c71395f743ee87503268ff5f3f467b604f32-4af5ab784c49a6367af2.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-cf55319c832a7ec2f72f.js"/><link as="fetch" rel="preload" href="/page-data/blog/2020-10-22-cra-snowpack/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="core__Box-eqpeba-0 jlbBry"><div class="core__Box-eqpeba-0 core__Text-eqpeba-2 gQsBqH"><h2 font-size="3" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 bhvpAY">Peter Beshai</h2><ul class="core__Box-eqpeba-0 core__List-eqpeba-9 core__InlineList-eqpeba-10 eKUuZz"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/">Home</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/#writing">Writing</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/#projects">Projects</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/#experiments">Experiments</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu" href="/#open-source">Open Source</a></li></ul></div></div><div class="core__Box-eqpeba-0 jlbBry"><h2 font-size="4" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 WSIGj">Use Snowpack for ultra fast dev builds with Create React App</h2><ul color="gray.6" class="core__Box-eqpeba-0 core__List-eqpeba-9 core__InlineList-eqpeba-10 futIAd"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh">October 22, 2020</li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh">4 min read</li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://github.com/pbeshai/cra-snowpack/pull/1/files" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">GitHub</a></li></ul><div><div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Long ago I gave up the ways of customizing webpack and embraced <a href="https://create-react-app.dev/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">create-react-app</a> (CRA) as a someone-else-has-solved-it-for-me way to live. It&#x27;s been great, truly. But could it be better? At least <a href="https://www.youtube.com/watch?v=qSfdtmcZ4d0" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Rich Harris seems to think so</a>— he points to <a href="https://www.snowpack.dev/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Snowpack</a> (or similarly minded tech) as the way forward.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">What makes Snowpack special? According to <a href="https://www.snowpack.dev/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">snowpack.dev</a>:</div>
<blockquote>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Snowpack leverages JavaScript’s native module system (known as ESM) to create a first-of-its-kind build system that never builds the same file twice. Snowpack pushes changes instantly to the browser, saving you hours of development time traditionally spent waiting around for your bundler.</div>
</blockquote>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">This architecture makes Snowpack fantastic for fast rebuilds during dev, but leaves work to be done for production builds if you want your coded bundled. To do so requires configuring the <a href="https://github.com/snowpackjs/snowpack/tree/master/plugins/plugin-webpack" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">@snowpack/plugin-webpack</a>, which I&#x27;m entirely uninterested in doing. But hey, CRA does a good enough job with bundling prod builds, so why not keep using it for prod and only use Snowpack for dev? That is the setup this post aims to share.</div>
<h2 font-size="4" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 senpC">So what do we actually have to do?</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Turns out, not very much. Feel free to jump ahead and view the end product with all required changes as a <a href="https://github.com/pbeshai/cra-snowpack/pull/1/files" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">PR on GitHub</a>.</div>
<h2 font-size="2" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 zunmK">Step 1. Add two snowpack dependencies</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install snowpack @snowpack/app-scripts-react</code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Note that <a href="https://github.com/snowpackjs/snowpack/blob/master/create-snowpack-app/app-scripts-react/snowpack.config.js" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">@snowpack/app-scripts-react</a> includes support for dotenv and react fast refresh. If you&#x27;re using SCSS or other extensions, you may have to <a href="https://www.snowpack.dev/#recipes" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">add more plugins</a>. </div>
<h2 font-size="2" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 zunmK">Step 2. Add snowpack.config.js to your root dir</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">The most basic <code class="language-text">snowpack.config.js</code> contains the following:</div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token string">&#x27;@snowpack/app-scripts-react&#x27;</span><span class="token punctuation">,</span>

  devOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    src<span class="token operator">:</span> <span class="token string">&#x27;src&#x27;</span><span class="token punctuation">,</span>
    bundle<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    fallback<span class="token operator">:</span> <span class="token string">&#x27;index.html&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  installOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    polyfillNode<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">The <a href="https://github.com/pbeshai/cra-snowpack/blob/main/snowpack.config.js" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">example in the repo</a> additionally shows how to configure a proxy, where to add additional plugins, and how to emulate <code class="language-text">baseUrl: &quot;.&quot;</code> from a jsconfig.json.</div>
<h2 font-size="2" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 zunmK">Step 3. (Optionally) Add babel.config.json to your root dir</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">This step is only required if you do not use the <code class="language-text">.jsx</code> extension for files containing JSX. If you put JSX in <code class="language-text">.js</code> files, you&#x27;ll need babel to build your code, which Snowpack knows to use by the presence of this file (or <code class="language-text">.babelrc</code>). If all your JSX lives in <code class="language-text">.jsx</code> files, Snowpack can handle it directly without any babel config.</div>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-react&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 font-size="2" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 zunmK">Step 4. (Optionally) Set up postcss</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Your app may work fine without making these changes, but they were a bit of a struggle to get right, so I&#x27;m sharing them here. In order to <a href="https://github.com/facebook/create-react-app/blob/0a93e32a434ba9995feb1a879bebf520fa6464e6/packages/react-scripts/config/webpack.config.js#L109-L133" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">match create-react-app&#x27;s CSS transformations</a> and <a href="https://github.com/snowpackjs/snowpack/issues/389" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">interpretations of <code class="language-text">@import</code>s</a>, we need to use <a href="https://postcss.org/" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">postcss</a>.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">First, we need to install some dependencies:</div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install postcss-cli postcss-flexbugs-fixes postcss-import postcss-normalize postcss-preset-env</code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp"><em>Note:</em> PostCSS 8 only recently came out and not everything is updated to work with it yet, so I actually specified postcss@^7.1.2 and postcss-import@^12.0.1 when I wrote this.</div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Next, we modify <strong>snowpack.config.js</strong> to include <strong>plugins</strong></div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// use postcss to get relative imports working and to match CRA</span>
    <span class="token punctuation">[</span>
      <span class="token string">&#x27;@snowpack/plugin-build-script&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> cmd<span class="token operator">:</span> <span class="token string">&#x27;postcss $FILE&#x27;</span><span class="token punctuation">,</span> input<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;.css&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> output<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;.css&#x27;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Finally, we add <strong>postcss.config.js</strong></div>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// need this to get relative @import &quot;./Foo.css&quot;; working</span>
      <span class="token string">&#x27;postcss-import&#x27;</span><span class="token operator">:</span> <span class="token punctuation">{</span> root<span class="token operator">:</span> ctx<span class="token punctuation">.</span>file<span class="token punctuation">.</span>dirname <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// copied from create-react-app</span>
      <span class="token string">&#x27;postcss-flexbugs-fixes&#x27;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&#x27;postcss-preset-env&#x27;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        autoprefixer<span class="token operator">:</span> <span class="token punctuation">{</span>
          flexbox<span class="token operator">:</span> <span class="token string">&#x27;no-2009&#x27;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        stage<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&#x27;postcss-normalize&#x27;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">You&#x27;ll see this is a bit atypical for a postcss config, but we need to know the current file when running postcss-import to get relative imports resolved correctly. This is also why we set <code class="language-text">postcss $FILE</code> as the cmd in snowpack.config.js above as opposed to just <code class="language-text">postcss</code> as <a href="https://www.snowpack.dev/#%40snowpack%2Fplugin-build-script" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">the Snowpack docs show</a>.</div>
<h2 font-size="2" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 zunmK">Step 5. Configure your start script in package.json</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">I keep the CRA start script around just in case, but you shouldn&#x27;t need it anymore.</div>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;snowpack dev --config snowpack.config.js&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;start:cra&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts start&quot;</span><span class="token punctuation">,</span></code></pre></div>
<h2 font-size="2" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 zunmK">Step 6. Update index.html to include the snowpack dev entrypoint</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Things get a bit weird here. What we want is code that the CRA minifier will remove during production builds, but will still be run when using the snowpack dev server. </div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">The trick is to use a snowpack specific interpolation variable called <a href="https://www.snowpack.dev/#environment-variables" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu"><code class="language-text">%MODE%</code></a> (essentially the same as <code class="language-text">process.env.NODE_ENV</code>). This interpolation only exists in the snowpack dev server, not in CRA, so the if statement will be analyzed as dead code and be pruned during the prod builds.</div>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noscript</span><span class="token punctuation">&gt;</span></span>You need to enable JavaScript to run this app.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noscript</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- 
    add entry for snowpack, only used in dev, it is pruned in production.
  --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#x27;%MODE%&#x27;</span> <span class="token operator">===</span> <span class="token string">&#x27;development&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// we wrap this in a function to prevent the variables from leaking out</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;[dev] injecting snowpack entry&#x27;</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> snowpackEntryScript <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;script&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        snowpackEntryScript<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;type&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;module&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        snowpackEntryScript<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;src&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;/_dist_/index.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>snowpackEntryScript<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></code></pre></div>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">If you view the index.html after running a CRA build, you&#x27;ll see that the script was mostly pruned. It is rendered as <code class="language-text">&lt;script&gt;0&lt;/script&gt;</code>, effectively doing nothing. Not quite as good as &quot;not there at all,&quot; but close enough for me.</div>
<h2 font-size="4" font-weight="bold" font-family="header" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__Header-eqpeba-3 senpC">Conclusion</h2>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Is it really a good idea to use a different build system for dev and production? Maybe not, but it sure is fun to try out. I hope the steps above have helped you figure out how to tempt fate and give Snowpack a shot. </div>
<ul class="core__Box-eqpeba-0 core__List-eqpeba-9 cVFjsM">
<li class="core__Box-eqpeba-0 ebIbsV">See <a href="https://github.com/pbeshai/cra-snowpack/pull/1/files" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">the PR containing all the changes here</a></li>
<li class="core__Box-eqpeba-0 ebIbsV">See <a href="https://github.com/pbeshai/cra-snowpack" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">the repo with the changes merged into a blank CRA app</a></li>
</ul>
<div class="core__Box-eqpeba-0 core__Text-eqpeba-2 dzArUp">Thanks for reading! If you&#x27;ve got any questions, feel free to reach out to me on twitter <a href="https://twitter.com/pbesh" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">@pbesh</a>.</div></div><div class="core__Box-eqpeba-0 gofAlC"><div shortname="peter-beshai" config="[object Object]" id="disqus_thread"></div></div></div><div class="core__Box-eqpeba-0 krNbLw"><div class="core__Box-eqpeba-0 core__Text-eqpeba-2 gQsBqH"><ul class="core__Box-eqpeba-0 core__List-eqpeba-9 core__InlineList-eqpeba-10 eKUuZz"><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="mailto:peter.beshai@gmail.com" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">peter.beshai@gmail.com</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://twitter.com/pbesh" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Twitter</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://www.linkedin.com/in/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">LinkedIn</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://github.com/pbeshai" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">GitHub</a></li><li class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__InlineListItem-eqpeba-11 clizFh"><a href="https://instagram.com/pbeshasketch" class="core__Box-eqpeba-0 core__Text-eqpeba-2 core__StyledLink-eqpeba-4 iUCFnu">Instagram</a></li></ul></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-55938435-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2020-10-22-cra-snowpack/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b540199392df4ae4b2b3.js"],"app":["/app-69ce7114bdda5fe6dd69.js"],"component---src-pages-404-js":["/component---src-pages-404-js-068e2989b2757c283e4d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-9f01cb6a6ce89fbd850d.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-cf55319c832a7ec2f72f.js"],"component---src-templates-demo-js":["/component---src-templates-demo-js-1d19251ac55752766669.js"]};/*]]>*/</script><script src="/polyfill-b540199392df4ae4b2b3.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-cf55319c832a7ec2f72f.js" async=""></script><script src="/21b0c71395f743ee87503268ff5f3f467b604f32-4af5ab784c49a6367af2.js" async=""></script><script src="/commons-47fd07ee46cd5b86e697.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-69ce7114bdda5fe6dd69.js" async=""></script><script src="/framework-d80f7338bc29523a5c3b.js" async=""></script><script src="/webpack-runtime-87626a9fc4ca94b3c336.js" async=""></script></body></html>